# 累計配当グラフ機能 仕様書

## 1. ドキュメント情報

- **作成日**: 2026年2月6日
- **対象バージョン**: v0.6.0（予定）
- **対象読者**: 開発者、プロダクトオーナー、レビュアー
- **関連Issue**: 累計配当グラフ実装検討

---

## 2. 機能概要

### 2.1 目的

累計配当グラフ機能は、投資家が配当金の累積受取額の推移を視覚的に把握するための機能です。現在の「年別配当グラフ」は各年の配当金額を表示していますが、本機能では配当金の累計額を表示することで、長期的な資産形成の進捗を確認できるようにします。

### 2.2 ユースケース

- **投資初心者**: 配当金がどのように積み上がっているかを確認し、投資のモチベーションを維持する
- **中長期投資家**: 配当再投資戦略の効果を確認し、投資計画を見直す
- **資産形成層**: 将来の配当金収入を予測するための基礎データとして活用する

### 2.3 機能の範囲

**対象**:
- 新規画面の追加（累計配当グラフ画面）
- 年別累計配当金の折れ線グラフ表示
- 為替レート設定機能
- 累計配当金集計テーブル表示

**対象外**（将来の拡張候補）:
- 配当再投資シミュレーション機能
- 予測・トレンドライン表示
- 複数ポートフォリオの比較機能
- データのエクスポート機能

---

## 3. 画面仕様

### 3.1 画面構成

```
+--------------------------------------------------+
|  Header（既存のHeaderコンポーネントを再利用）      |
+--------------------------------------------------+
|                                                  |
|  累計配当グラフ                                    |
|                                                  |
|  [為替レート設定欄]                                |
|  1ドル = [___150___] 円                          |
|                                                  |
|  +----------------------------------------------+|
|  |                                              ||
|  |          累計配当金 折れ線グラフ               ||
|  |                                              ||
|  |    Y軸: 累計配当金（円）                      ||
|  |    X軸: 年                                   ||
|  |                                              ||
|  +----------------------------------------------+|
|                                                  |
|  年別累計配当金集計                                |
|  +----------------------------------------------+|
|  | 年       | 年間配当金 | 累計配当金            ||
|  |----------|-----------|----------------------||
|  | 2020年   | ¥50,000   | ¥50,000              ||
|  | 2021年   | ¥80,000   | ¥130,000             ||
|  | 2022年   | ¥120,000  | ¥250,000             ||
|  | ...      | ...       | ...                  ||
|  +----------------------------------------------+|
|                                                  |
|  ※説明文                                         |
|                                                  |
+--------------------------------------------------+
```

### 3.2 画面要素詳細

#### 3.2.1 ヘッダー
- 既存の`Header`コンポーネントを再利用
- ナビゲーションに「累計配当グラフ」のリンクを追加

#### 3.2.2 タイトル
- テキスト: "累計配当グラフ"
- フォントサイズ: 4xl
- カラー: グレー800（ダークモード時: グレー200）

#### 3.2.3 為替レート設定欄
- 既存の年別配当グラフと同じUIコンポーネントを使用
- 数値入力フィールド
  - 初期値: 環境変数`NEXT_PUBLIC_USD_TO_JPY_RATE`または150円
  - 最小値: 1
  - ステップ: 0.01
  - バリデーション: 正の数値のみ受付
  - リアルタイム反映: 入力値が変更されるたびにグラフと表を再計算

#### 3.2.4 累計配当金グラフ
- グラフタイプ: 折れ線グラフ（LineChart）
- ライブラリ: Recharts
- データポイント: 年別累計配当金
- X軸: 年（例: "2020年", "2021年", ...）
- Y軸: 累計配当金（円）
- 線のスタイル:
  - カラー: ブルー600（#3b82f6）
  - 線幅: 2px
  - タイプ: monotone（滑らかな曲線）
- グリッド: 破線（3px間隔）
- ツールチップ:
  - 年
  - 年間配当金: ¥XX,XXX
  - 累計配当金: ¥XXX,XXX
- レジェンド: "累計配当金（税引き後）[円]"
- レスポンシブ対応: ResponsiveContainerで画面幅に追従

#### 3.2.5 累計配当金集計テーブル
- カラム構成:
  1. 年（右寄せ）
  2. 税引後年間配当[円]（右寄せ）
  3. 税引後累計配当[円]（右寄せ）
- ソート順: 年の昇順（古い年から新しい年へ）
- 数値フォーマット: 3桁区切りカンマ、円記号付き
- スタイリング:
  - ヘッダー: グレー100背景（ダークモード時: グレー700）
  - 行: ホワイト背景（ダークモード時: グレー800）
  - ボーダー: グレー200（ダークモード時: グレー700）
- スクロール対応: 横スクロール可能なコンテナでラップ

#### 3.2.6 説明文
- 内容:
  ```
  このグラフは、配当金データから年別に税引き後の配当金を累計して表示しています。
  ※ USドル建ての配当金は1ドル={為替レート}円で換算しています。
  ```
- スタイル: テキストサイズ小、グレー500（ダークモード時: グレー400）

---

## 4. データ仕様

### 4.1 データソース

- CSVファイル: `public/data/dividendlist_YYYYMMDD.csv`
- エンコーディング: Shift-JIS
- 必須カラム:
  - `入金日`: YYYY/MM/DD形式
  - `受取通貨`: 例: "円", "USドル"
  - `受取金額[円/現地通貨]`: 配当金額（税引き後）

### 4.2 データ型定義

```typescript
/**
 * 累計配当金データの型定義
 * グラフ表示に使用される年別累計配当金の集計データ
 */
type CumulativeDividendData = {
  /** 表示用の年（例: "2024年"） */
  year: string;
  /** 年間配当金合計（税引き後）[円] */
  yearlyDividend: number;
  /** 累計配当金（税引き後）[円] */
  cumulativeDividend: number;
};
```

### 4.3 データ処理フロー

```
1. CSVファイル読み込み
   ↓
2. Shift-JISデコード
   ↓
3. Papa.parseでCSVパース
   ↓
4. 年別に配当金を集計
   - 入金日から年を抽出
   - USドル建て配当を為替レートで円換算
   - 年別に合計
   ↓
5. 累計配当金を計算
   - 年でソート（昇順）
   - 前年までの累計 + 当年の配当金 = 当年の累計
   ↓
6. グラフデータに変換
   ↓
7. 画面に表示
```

### 4.4 計算ロジック

#### 年間配当金の計算
```typescript
// 既存の年別配当グラフと同じロジック
yearlyDividends[year] = (yearlyDividends[year] || 0) + amountInYen;
```

#### 累計配当金の計算
```typescript
let cumulative = 0;
const cumulativeData = sortedYears.map((year) => {
  const yearlyAmount = yearlyDividends[year];
  cumulative += yearlyAmount;
  return {
    year: `${year}年`,
    yearlyDividend: Math.round(yearlyAmount),
    cumulativeDividend: Math.round(cumulative),
  };
});
```

#### 為替換算
```typescript
// USドル建て配当の場合
if (currency === 'USドル') {
  amountInYen = amountValue * exchangeRate;
} else {
  amountInYen = amountValue;
}
```

---

## 5. ルーティング仕様

### 5.1 URL構成

| 画面名             | パス                  | 説明                     |
|-------------------|----------------------|------------------------|
| 年別配当グラフ（既存） | `/`                  | 年別配当金の棒グラフ・折れ線グラフ |
| 累計配当グラフ（新規）| `/cumulative`        | 年別累計配当金の折れ線グラフ     |

### 5.2 Next.js App Routerの構成

```
src/app/
├── page.tsx                    # 既存: 年別配当グラフ画面
├── cumulative/
│   └── page.tsx                # 新規: 累計配当グラフ画面
├── components/
│   ├── DarkModeProvider.tsx    # 既存
│   ├── Header.tsx              # 既存（ナビゲーション追加）
│   ├── DividendChart.tsx       # 新規候補: グラフコンポーネント（将来の共通化用）
│   └── DividendTable.tsx       # 新規候補: テーブルコンポーネント（将来の共通化用）
├── lib/
│   └── dividendCalculator.ts   # 新規候補: 配当金計算ロジック（将来の共通化用）
├── layout.tsx                  # 既存
└── globals.css                 # 既存
```

---

## 6. コンポーネント設計

### 6.1 新規作成コンポーネント

#### 6.1.1 `/cumulative/page.tsx`
- 役割: 累計配当グラフ画面のメインコンポーネント
- 責務:
  - CSVデータ読み込み
  - 年別累計配当金の計算
  - 為替レート管理
  - グラフ表示
  - テーブル表示
- 状態管理:
  - `data`: 累計配当金データ配列
  - `loading`: ローディング状態
  - `error`: エラーメッセージ
  - `usdToJpyRate`: 為替レート
  - `inputValue`: 為替レート入力値
  - `rawData`: 生のCSVデータ
- Hooks:
  - `useState`: 状態管理
  - `useEffect`: データ読み込みと再計算
  - `useCallback`: 計算関数のメモ化

### 6.2 既存コンポーネントの変更

#### 6.2.1 `Header.tsx`
- 変更内容: ナビゲーションリンクの追加
- Before:
  ```tsx
  <Link href="/">ホーム</Link>
  ```
- After:
  ```tsx
  <Link href="/">年別配当グラフ</Link>
  <Link href="/cumulative">累計配当グラフ</Link>

### 6.3 将来の共通化候補（今回の実装対象外）

以下のコンポーネントは今回は既存の`page.tsx`と新規の`/cumulative/page.tsx`で個別に実装しますが、将来的に共通化を検討します。

- `DividendChart`: グラフ表示コンポーネント
- `DividendTable`: テーブル表示コンポーネント
- `ExchangeRateInput`: 為替レート入力コンポーネント
- `useDividendData`: データ読み込みカスタムフック

---

## 7. スタイリング仕様

### 7.1 デザインシステム

既存の年別配当グラフ画面と統一感を持たせるため、同じデザインシステムを使用します。

#### 7.1.1 カラーパレット
- **プライマリ**: ブルー600（#3b82f6）
- **背景（ライト）**: グラデーション（ブルー50 → インディゴ100）
- **背景（ダーク）**: グラデーション（グレー900 → グレー800）
- **カード背景（ライト）**: ホワイト
- **カード背景（ダーク）**: グレー800
- **テキスト（ライト）**: グレー800
- **テキスト（ダーク）**: グレー200

#### 7.1.2 タイポグラフィ
- **タイトル**: 4xl、フォントウェイト: bold
- **セクションタイトル**: xl、フォントウェイト: semibold
- **ラベル**: sm、フォントウェイト: medium
- **説明文**: sm、フォントウェイト: normal

#### 7.1.3 スペーシング
- **ページパディング**: 32px（8単位）
- **カード内パディング**: 32px（8単位）
- **セクション間マージン**: 24px（6単位）
- **要素間マージン**: 16px（4単位）

#### 7.1.4 ボーダー・シャドウ
- **カードボーダーラディウス**: 16px（2xl）
- **カードシャドウ**: lg
- **入力フィールドボーダー**: 1px、グレー300（ダーク: グレー600）
- **フォーカスリング**: 2px、ブルー500

### 7.2 レスポンシブデザイン

#### 7.2.1 ブレークポイント
- **モバイル**: < 640px
- **タブレット**: 640px - 1024px
- **デスクトップ**: >= 1024px

#### 7.2.2 グラフの高さ
- **デスクトップ**: 400px
- **タブレット**: 350px
- **モバイル**: 300px

#### 7.2.3 テーブルのスクロール
- 画面幅が狭い場合、テーブルを横スクロール可能にする
- `overflow-x-auto`クラスを使用

---

## 8. 技術仕様

### 8.1 使用技術スタック

| 技術               | バージョン       | 用途                    |
|-------------------|----------------|------------------------|
| Next.js           | 16.1.6         | フレームワーク            |
| React             | 19.2.4         | UIライブラリ             |
| TypeScript        | package.json参照 | 型安全性                |
| Tailwind CSS      | 4              | スタイリング             |
| Recharts          | package.json参照 | グラフ描画               |
| PapaParse         | package.json参照 | CSV解析                 |

### 8.2 パフォーマンス要件

- **初回ロード時間**: < 3秒
- **データ更新時間**: < 500ms（為替レート変更時）
- **グラフレンダリング**: < 200ms
- **テーブルレンダリング**: < 100ms

### 8.3 ブラウザサポート

- Chrome: 最新2バージョン
- Firefox: 最新2バージョン
- Safari: 最新2バージョン
- Edge: 最新2バージョン

### 8.4 アクセシビリティ

- **WCAG 2.1 Level AA準拠を目指す**
- 主要な考慮事項:
  - セマンティックHTML使用
  - キーボードナビゲーション対応
  - 適切なカラーコントラスト比（4.5:1以上）
  - スクリーンリーダー対応（aria-label等）
  - フォーカスインジケーターの明示

---

## 9. 実装計画

### 9.1 実装フェーズ

#### Phase 1: 基本機能実装（優先度: 高）
- [ ] `/cumulative/page.tsx`の作成
- [ ] CSVデータ読み込み機能
- [ ] 累計配当金計算ロジック
- [ ] 折れ線グラフ表示
- [ ] テーブル表示
- [ ] 為替レート設定機能
- [ ] `Header.tsx`にナビゲーション追加

#### Phase 2: UI/UX改善（優先度: 中）
- [ ] ローディングスピナーの実装
- [ ] エラーハンドリングの実装
- [ ] ツールチップのカスタマイズ
- [ ] ダークモード対応
- [ ] レスポンシブデザインの調整

#### Phase 3: テスト・品質保証（優先度: 高）
- [ ] ユニットテストの作成
- [ ] 統合テストの作成
- [ ] E2Eテストの作成（Playwright）
- [ ] アクセシビリティテスト
- [ ] パフォーマンステスト

#### Phase 4: ドキュメント整備（優先度: 中）
- [ ] README.mdの更新
- [ ] コードコメントの追加
- [ ] ユーザーガイドの作成（必要に応じて）

### 9.2 タスク見積もり

| タスク                    | 見積もり工数 | 備考                          |
|--------------------------|------------|-------------------------------|
| 仕様策定                  | 4h         | 本ドキュメント作成              |
| コンポーネント実装        | 6h         | `/cumulative/page.tsx`他       |
| スタイリング              | 3h         | Tailwind CSS適用              |
| データ処理ロジック        | 4h         | 累計計算、為替換算             |
| テスト作成                | 6h         | ユニット・統合テスト           |
| バグ修正・調整            | 3h         | 予備                          |
| コードレビュー対応        | 2h         | レビューフィードバック対応     |
| **合計**                  | **28h**    | 約3.5人日                     |

### 9.3 リスクと対応策

| リスク                              | 影響度 | 発生確率 | 対応策                                    |
|------------------------------------|--------|---------|------------------------------------------|
| CSVデータ形式の変更                  | 高     | 低      | データバリデーションの強化、後方互換性の確保 |
| 大量データでのパフォーマンス劣化      | 中     | 中      | ページネーション、仮想スクロールの検討      |
| 為替レート設定の誤入力               | 低     | 高      | 入力バリデーション、範囲制限の実装         |
| 既存機能への影響                     | 高     | 低      | リグレッションテストの徹底実施             |
| デザインの統一感の欠如               | 中     | 中      | デザインシステムの厳守、レビューの徹底      |

---

## 10. テスト仕様

### 10.1 ユニットテスト

#### テスト対象: 累計配当金計算ロジック
```typescript
describe('calculateCumulativeDividendData', () => {
  test('年別累計配当金が正しく計算される', () => {
    const csvData = [
      { '入金日': '2020/01/15', '受取通貨': '円', '受取金額[円/現地通貨]': '10000' },
      { '入金日': '2020/06/15', '受取通貨': '円', '受取金額[円/現地通貨]': '15000' },
      { '入金日': '2021/01/15', '受取通貨': '円', '受取金額[円/現地通貨]': '20000' },
    ];
    const result = calculateCumulativeDividendData(csvData, 150);
    
    expect(result).toEqual([
      { year: '2020年', yearlyDividend: 25000, cumulativeDividend: 25000 },
      { year: '2021年', yearlyDividend: 20000, cumulativeDividend: 45000 },
    ]);
  });

  test('USドル建て配当が正しく換算される', () => {
    const csvData = [
      { '入金日': '2020/01/15', '受取通貨': 'USドル', '受取金額[円/現地通貨]': '100' },
    ];
    const result = calculateCumulativeDividendData(csvData, 150);
    
    expect(result[0].yearlyDividend).toBe(15000); // 100 * 150
    expect(result[0].cumulativeDividend).toBe(15000);
  });

  test('為替レート変更時に再計算される', () => {
    const csvData = [
      { '入金日': '2020/01/15', '受取通貨': 'USドル', '受取金額[円/現地通貨]': '100' },
    ];
    
    const result1 = calculateCumulativeDividendData(csvData, 150);
    const result2 = calculateCumulativeDividendData(csvData, 140);
    
    expect(result1[0].yearlyDividend).toBe(15000);
    expect(result2[0].yearlyDividend).toBe(14000);
  });
});
```

#### テスト対象: コンポーネントレンダリング
```typescript
describe('CumulativeDividendPage', () => {
  test('ローディング中はスピナーが表示される', () => {
    render(<CumulativeDividendPage />);
    expect(screen.getByText('読み込み中...')).toBeInTheDocument();
  });

  test('データ読み込み後にグラフとテーブルが表示される', async () => {
    render(<CumulativeDividendPage />);
    
    await waitFor(() => {
      expect(screen.getByText('累計配当グラフ')).toBeInTheDocument();
      expect(screen.getByText('年別累計配当金集計')).toBeInTheDocument();
    });
  });

  test('為替レート変更時にデータが再計算される', async () => {
    render(<CumulativeDividendPage />);
    
    await waitFor(() => {
      expect(screen.getByDisplayValue('150')).toBeInTheDocument();
    });
    
    const input = screen.getByLabelText('為替レート（1ドル = 円）');
    fireEvent.change(input, { target: { value: '140' } });
    
    // データが再計算されることを確認
    await waitFor(() => {
      expect(screen.getByDisplayValue('140')).toBeInTheDocument();
    });
  });
});
```

### 10.2 統合テスト

#### テスト対象: CSVデータ読み込みから表示まで
```typescript
describe('Cumulative Dividend Integration', () => {
  test('CSVファイルを読み込んで累計配当グラフを表示する', async () => {
    // モックCSVデータをセットアップ
    global.fetch = jest.fn(() =>
      Promise.resolve({
        ok: true,
        arrayBuffer: () => Promise.resolve(mockCSVArrayBuffer),
      })
    );

    render(<CumulativeDividendPage />);

    await waitFor(() => {
      // グラフが表示されることを確認
      expect(screen.getByText('累計配当グラフ')).toBeInTheDocument();
      
      // テーブルにデータが表示されることを確認
      expect(screen.getByText('2020年')).toBeInTheDocument();
      expect(screen.getByText('¥50,000')).toBeInTheDocument();
    });
  });
});
```

### 10.3 E2Eテスト（Playwright）

#### 10.3.1 前提条件・セットアップ

本仕様では、E2Eテストに [Playwright](https://playwright.dev/)（`@playwright/test`）を利用することを想定します。  
実行には、以下の前提と初期セットアップが必要です。

- `devDependencies` に `@playwright/test` を追加する
  - 例: `npm install --save-dev @playwright/test`
- ブラウザバイナリのインストール
  - 例: `npx playwright install`
- プロジェクトルートに `playwright.config.ts` を作成し、少なくとも以下を設定する
  - `testDir`: `tests/e2e` 等、E2Eテスト配置ディレクトリ
  - `use.baseURL`: `http://localhost:3000`（`npm run dev` で起動するNext.jsのURL）
- `package.json` にE2Eテスト用スクリプトを追加する
  - 例: `"test:e2e": "playwright test"`
- CI（GitHub Actions）への組み込み
  - 既存のテスト・ビルドジョブに以下のステップを追加する想定
    - 依存関係インストール後に `npx playwright install --with-deps`（必要に応じて）
    - アプリケーションを起動（`npm run dev` など）し、別ジョブまたはステップで `npm run test:e2e` を実行

上記の前提が整っていることを前提に、累計配当グラフページのE2Eテスト例を以下に示します。
```typescript
test('累計配当グラフページが正しく動作する', async ({ page }) => {
  // ページに移動
  await page.goto('http://localhost:3000/cumulative');
  
  // タイトルが表示されることを確認
  await expect(page.locator('h1')).toContainText('累計配当グラフ');
  
  // グラフが表示されることを確認
  await expect(page.locator('.recharts-wrapper')).toBeVisible();
  
  // テーブルが表示されることを確認
  await expect(page.locator('table')).toBeVisible();
  
  // 為替レート変更前のテーブル内容を取得
  const beforeTableContent = await page.textContent('table');
  
  // 為替レートを変更
  await page.fill('input[type="number"]', '140');
  
  // テーブルの値が変更されることを確認（DOM更新を待つ）
  await expect
    .poll(async () => await page.textContent('table'))
    .not.toBe(beforeTableContent);
});

test('ヘッダーのナビゲーションが機能する', async ({ page }) => {
  // 年別配当グラフページから開始
  await page.goto('http://localhost:3000');
  
  // 累計配当グラフリンクをクリック
  await page.click('text=累計配当グラフ');
  
  // URLが変更されることを確認
  await expect(page).toHaveURL('http://localhost:3000/cumulative');
  
  // ページコンテンツが表示されることを確認
  await expect(page.locator('h1')).toContainText('累計配当グラフ');
});
```

---

## 11. 既存機能との比較

### 11.1 年別配当グラフ vs 累計配当グラフ

| 項目                | 年別配当グラフ（既存）        | 累計配当グラフ（新規）      |
|--------------------|--------------------------|--------------------------|
| URL                | `/`                      | `/cumulative`            |
| グラフタイプ        | 棒グラフ / 折れ線グラフ    | 折れ線グラフのみ          |
| Y軸データ          | 年間配当金               | 累計配当金                |
| グラフ切り替え      | あり                     | なし（折れ線のみ）        |
| 為替レート設定      | あり                     | あり                      |
| テーブル表示        | あり（2カラム）          | あり（3カラム）           |
| テーブルカラム      | 年、配当金               | 年、年間配当金、累計配当金 |
| データソース        | 同じCSVファイル          | 同じCSVファイル           |
| 計算ロジック        | 年別集計                 | 年別集計 + 累計計算       |

### 11.2 共通部分

以下の機能は両画面で共通です：

- CSVデータ読み込み
- Shift-JISデコード
- USドル建て配当の円換算
- 為替レート設定
- ダークモード対応
- レスポンシブデザイン
- エラーハンドリング
- ローディング状態の表示

---

## 12. 将来の拡張案

本仕様は基本機能の実装を目的としていますが、将来的に以下の拡張を検討できます。

### 12.1 機能拡張

1. **配当再投資シミュレーション**
   - 配当金を再投資した場合の累計額をシミュレーション
   - 再投資利回りの設定機能
   - 通常累計と再投資累計の比較グラフ

2. **予測・トレンドライン**
   - 過去データから将来の配当金を予測
   - 線形回帰やその他の予測モデルの適用
   - 予測範囲の信頼区間表示

3. **複数ポートフォリオの比較**
   - 複数のCSVファイルを読み込み
   - ポートフォリオごとの累計配当を比較表示
   - ポートフォリオ選択UI

4. **目標設定機能**
   - 累計配当金の目標値を設定
   - 目標達成度の可視化
   - 目標達成予定日の計算

5. **データエクスポート**
   - グラフ画像のダウンロード（PNG/SVG）
   - テーブルデータのエクスポート（CSV/Excel）
   - PDFレポート生成

6. **統計情報の追加表示**
   - 年平均配当金
   - 配当成長率（CAGR）
   - 標準偏差
   - 最大・最小配当年

### 12.2 技術的改善

1. **パフォーマンス最適化**
   - データキャッシング
   - 仮想スクロール（大量データ対応）
   - Web Workerでの計算処理

2. **データ管理の改善**
   - 複数CSVファイルの自動検出
   - データベース連携（将来的に）
   - リアルタイムデータ更新

3. **コンポーネントの共通化**
   - グラフコンポーネントの抽象化
   - テーブルコンポーネントの抽象化
   - カスタムフックの共通化

4. **アクセシビリティの強化**
   - スクリーンリーダー対応の強化
   - キーボードショートカット
   - ハイコントラストモード

---

## 13. 参考資料

### 13.1 関連ドキュメント

- [開発者向けアプリ仕様書](./developer-specification.md)
- [改善点リスト](./improvements.md)
- [README.md](../README.md)

### 13.2 外部リソース

- [Recharts公式ドキュメント](https://recharts.org/)
- [Next.js App Router](https://nextjs.org/docs/app)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [TypeScript](https://www.typescriptlang.org/docs/)
- [WCAG 2.1](https://www.w3.org/WAI/WCAG21/quickref/)

### 13.3 デザイン参考

- [Material Design - Data Visualization](https://material.io/design/communication/data-visualization.html)
- [Apple Human Interface Guidelines - Charts](https://developer.apple.com/design/human-interface-guidelines/charts)

---

## 14. 変更履歴

| 日付       | バージョン | 変更者 | 変更内容                          |
|-----------|-----------|-------|----------------------------------|
| 2026-02-06 | 1.0.0     | AI    | 初版作成                          |

---

## 15. 承認

| 役割              | 氏名 | 日付 | 署名 |
|------------------|-----|------|------|
| プロダクトオーナー |     |      |      |
| テックリード       |     |      |      |
| レビュアー         |     |      |      |

---

## 付録A: UI/UXモックアップ

### A.1 デスクトップ表示

```
+------------------------------------------------------------------+
|  divichart-next-js-app    年別配当グラフ  累計配当グラフ     🌙    |
+------------------------------------------------------------------+
|                                                                  |
|    累計配当グラフ                                                |
|                                                                  |
|    為替レート（1ドル = 円）                                      |
|    [     150     ] 円                                           |
|                                                                  |
|    +----------------------------------------------------------+  |
|    |                                                          |  |
|    |  300,000 +                                    •          |  |
|    |          |                          •                    |  |
|    |  200,000 +              •                                |  |
|    |          |    •                                          |  |
|    |  100,000 +                                                |  |
|    |          |                                               |  |
|    |        0 +----+----+----+----+----+----+----+----+----+  |  |
|    |          2020 2021 2022 2023 2024 2025 2026 ...         |  |
|    |                                                          |  |
|    +----------------------------------------------------------+  |
|                                                                  |
|    年別累計配当金集計                                            |
|    +----------------------------------------------------------+  |
|    | 年       | 年間配当金（税引き後）[円] | 累計配当金（税引き後）[円] |  |
|    |----------|---------------------------|-------------------------|  |
|    | 2020年   | ¥50,000                   | ¥50,000                 |  |
|    | 2021年   | ¥80,000                   | ¥130,000        |  |
|    | 2022年   | ¥120,000                  | ¥250,000        |  |
|    +----------------------------------------------------------+  |
|                                                                  |
|    このグラフは、配当金データから年別に税引き後の配当金を累計して |
|    表示しています。                                              |
|    ※ USドル建ての配当金は1ドル=150円で換算しています。           |
|                                                                  |
+------------------------------------------------------------------+
```

### A.2 モバイル表示

```
+-------------------------+
| divichart-next-js-app   |
|  ≡              🌙      |
+-------------------------+
|                         |
| 累計配当グラフ           |
|                         |
| 為替レート              |
| [  150  ] 円            |
|                         |
| +---------------------+ |
| |         •           | |
| |       •             | |
| |     •               | |
| |   •                 | |
| | •                   | |
| +---------------------+ |
|  '20 '21 '22 '23 '24   |
|                         |
| 年別累計配当金集計       |
| +---------------------+ |
| |年   |年間|累計       | |
| |----|----|-----------| |
| |'20 |50K |50K        | |
| |'21 |80K |130K       | |
| +---------------------+ |
|                         |
| このグラフは...         |
|                         |
+-------------------------+
```

---

## 付録B: データフロー図

```
┌─────────────────┐
│   CSVファイル    │ (Shift-JIS)
└────────┬────────┘
         │
         │ fetch
         ▼
┌─────────────────┐
│  arrayBuffer    │
└────────┬────────┘
         │
         │ TextDecoder('shift-jis')
         ▼
┌─────────────────┐
│  CSV Text       │
└────────┬────────┘
         │
         │ Papa.parse
         ▼
┌─────────────────┐
│  CSVRow[]       │
└────────┬────────┘
         │
         │ calculateCumulativeDividendData
         ▼
┌─────────────────┐
│  年別配当金集計  │
│  {2020: 50000}  │
│  {2021: 80000}  │
└────────┬────────┘
         │
         │ 累計計算
         ▼
┌──────────────────────┐
│ CumulativeDividend   │
│ Data[]               │
│ [{year, yearly,      │
│   cumulative}]       │
└────────┬─────────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌────────┐
│ グラフ │ │テーブル│
└────────┘ └────────┘
```

---

## 付録C: コンポーネント階層図

```
<RootLayout>
  └── <Header>
      └── ナビゲーション
          ├── 年別配当グラフ (/)
          └── 累計配当グラフ (/cumulative)

<CumulativeDividendPage> (/cumulative/page.tsx)
  ├── <div> タイトル: "累計配当グラフ"
  ├── <div> 為替レート入力
  │   └── <input type="number">
  ├── <ResponsiveContainer>
  │   └── <LineChart>
  │       ├── <CartesianGrid>
  │       ├── <XAxis>
  │       ├── <YAxis>
  │       ├── <Tooltip>
  │       │   └── <CustomTooltip>
  │       ├── <Legend>
  │       └── <Line>
  ├── <div> テーブルセクション
  │   └── <table>
  │       ├── <thead>
  │       └── <tbody>
  │           └── <tr> × N
  └── <div> 説明文
```

---

**END OF DOCUMENT**
