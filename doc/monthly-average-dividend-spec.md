# 月平均配当額表示機能 仕様書

## 1. ドキュメント情報

- **作成日**: 2026年2月6日
- **対象機能**: 月平均配当額表示機能
- **ステータス**: 仕様策定
- **対象読者**: 開発者、レビュアー

---

## 2. 機能概要

### 2.1 目的

配当金グラフ画面において、年別配当金集計表に「月平均配当額」カラムを追加し、各年の月あたりの平均配当額を表示することで、投資家がより詳細な配当金分析を行えるようにする。

### 2.2 ユーザーストーリー

投資家として、年間の総配当額だけでなく、月平均でどれくらいの配当収入があるかを知りたい。これにより、月次の収支計画や、配当金投資の効果をより実感しやすくなる。

---

## 3. UI設計

### 3.1 テーブルレイアウト

現在のテーブル構造：

```
┌──────┬──────────────────────────┐
│ 年   │ 配当金合計（税引き後）[円] │
├──────┼──────────────────────────┤
│ 2024年│ ¥120,000                │
│ 2025年│ ¥150,000                │
└──────┴──────────────────────────┘
```

変更後のテーブル構造：

```
┌──────┬──────────────────────────┬────────────────┐
│ 年   │ 配当金合計（税引き後）[円] │ 月平均配当額[円] │
├──────┼──────────────────────────┼────────────────┤
│ 2024年│ ¥120,000                │ ¥10,000        │
│ 2025年│ ¥150,000                │ ¥12,500        │
└──────┴──────────────────────────┴────────────────┘
```

### 3.2 UI要素の詳細

#### 3.2.1 カラムヘッダー

- **表示テキスト**: `月平均配当額[円]`
- **配置**: 「配当金合計（税引き後）[円]」カラムの右隣
- **テキストスタイル**: 既存カラムと同様
  - フォントサイズ: `text-xs`
  - フォントウェイト: `font-medium`
  - 大文字変換: `uppercase`
  - 文字間隔: `tracking-wider`
  - テキスト配置: `text-right`
  - ライトモード: `text-gray-700`
  - ダークモード: `dark:text-gray-300`

#### 3.2.2 データセル

- **表示形式**: `¥{金額の整数部分を3桁区切り}`
- **テキスト配置**: `text-right`（右寄せ）
- **テキストスタイル**: 既存のデータセルと同様
  - フォントサイズ: `text-sm`
  - ライトモード: `text-gray-900`
  - ダークモード: `dark:text-gray-300`
  - パディング: `px-6 py-4`
  - 空白処理: `whitespace-nowrap`

---

## 4. データ仕様

### 4.1 計算式

```
月平均配当額 = floor(年間配当金合計 / 12)
```

- **年間配当金合計**: `DividendData`型の`totalDividend`プロパティ（既に税引き後、円換算済み、四捨五入済み）
- **除数**: 12（固定値）
- **切り捨て処理**: `Math.floor()`関数を使用
- **結果**: 整数値（小数点以下なし）

### 4.2 計算例

| 年間配当金合計[円] | 計算式 | 月平均配当額[円] |
|-------------------|--------|-----------------|
| ¥120,000 | floor(120,000 / 12) | ¥10,000 |
| ¥150,000 | floor(150,000 / 12) | ¥12,500 |
| ¥125,500 | floor(125,500 / 12) | ¥10,458 |
| ¥100,001 | floor(100,001 / 12) | ¥8,333 |

### 4.3 端数処理の理由

- **切り捨て（floor）を選択**: 実際に手元に入る金額の保守的な見積もりとして、切り捨てが適切
- **四捨五入を選択しない理由**: 実際の収入より多く見積もってしまう可能性があるため
- **切り上げを選択しない理由**: さらに実際の金額から乖離するため

---

## 5. 実装方針

### 5.1 対象ファイル

#### 変更対象ファイル

1. **`src/app/page.tsx`**
   - テーブルヘッダーの追加（1箇所）
   - テーブルデータセルの追加（1箇所）
   - 月平均配当額の計算ロジック追加（インライン）

### 5.2 型定義の変更

既存の`DividendData`型は変更不要。月平均配当額はレンダリング時に計算するため、データ構造には含めない。

**理由**:
- 月平均配当額は`totalDividend / 12`という単純な計算で導出可能
- データ構造を肥大化させない
- 為替レート変更時の再計算が不要（`totalDividend`が既に再計算される）

### 5.3 コード変更箇所

#### 5.3.1 テーブルヘッダー（page.tsx 318-324行目付近）

**変更前**:
```tsx
<thead className="bg-gray-100 dark:bg-gray-700">
<tr>
    <th className="px-6 py-3 text-right text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
        年
    </th>
    <th className="px-6 py-3 text-right text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
        配当金合計（税引き後）[円]
    </th>
</tr>
</thead>
```

**変更後**:
```tsx
<thead className="bg-gray-100 dark:bg-gray-700">
<tr>
    <th className="px-6 py-3 text-right text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
        年
    </th>
    <th className="px-6 py-3 text-right text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
        配当金合計（税引き後）[円]
    </th>
    <th className="px-6 py-3 text-right text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
        月平均配当額[円]
    </th>
</tr>
</thead>
```

#### 5.3.2 テーブルデータセル（page.tsx 329-337行目付近）

**変更前**:
```tsx
{data.map((row) => (
    <tr key={row.year}>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300 text-right">
            {row.year}
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300 text-right">
            ¥{row.totalDividend.toLocaleString()}
        </td>
    </tr>
))}
```

**変更後**:
```tsx
{data.map((row) => (
    <tr key={row.year}>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300 text-right">
            {row.year}
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300 text-right">
            ¥{row.totalDividend.toLocaleString()}
        </td>
        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300 text-right">
            ¥{Math.floor(row.totalDividend / 12).toLocaleString()}
        </td>
    </tr>
))}
```

### 5.4 変更行数

- **追加行数**: 約6行（ヘッダー3行 + データセル3行）
- **削除行数**: 0行
- **変更行数**: 0行
- **合計影響行数**: 約6行

---

## 6. テストケース

### 6.1 単体テスト（追加推奨）

#### 6.1.1 月平均配当額の計算ロジックテスト

**テストファイル**: `__tests__/src/app/page.test.tsx`

**テストケース**:

1. **正常系: 割り切れる場合**
   - 入力: `totalDividend = 120000`
   - 期待値: `¥10,000`
   - 計算: `floor(120000 / 12) = 10000`

2. **正常系: 割り切れない場合（切り捨て確認）**
   - 入力: `totalDividend = 125500`
   - 期待値: `¥10,458`
   - 計算: `floor(125500 / 12) = 10458.333... → 10458`

3. **正常系: 端数が大きい場合**
   - 入力: `totalDividend = 100001`
   - 期待値: `¥8,333`
   - 計算: `floor(100001 / 12) = 8333.416... → 8333`

4. **正常系: 小額の配当金**
   - 入力: `totalDividend = 100`
   - 期待値: `¥8`
   - 計算: `floor(100 / 12) = 8.333... → 8`

5. **境界値: ゼロ配当**
   - 入力: `totalDividend = 0`
   - 期待値: `¥0`
   - 計算: `floor(0 / 12) = 0`

### 6.2 統合テスト（追加推奨）

#### 6.2.1 テーブル表示の検証

**テストシナリオ**:

1. **月平均配当額カラムの存在確認**
   - ヘッダーに「月平均配当額[円]」が表示されること
   - データ行に月平均配当額が表示されること

2. **フォーマットの検証**
   - 通貨記号（¥）が表示されること
   - 3桁区切りのカンマが正しく表示されること
   - 小数点以下が表示されないこと

3. **為替レート変更時の再計算**
   - 為替レートを変更した際、月平均配当額も再計算されること

### 6.3 手動テスト（UI確認）

#### 6.3.1 視覚的確認項目

- [ ] テーブルヘッダーが3カラムで正しく表示される
- [ ] 月平均配当額カラムが右端に配置される
- [ ] 数値が右寄せで表示される
- [ ] ライトモードで正しく表示される
- [ ] ダークモードで正しく表示される
- [ ] モバイル表示で横スクロールが機能する
- [ ] 為替レート変更時に月平均配当額も更新される

#### 6.3.2 データ確認項目

- [ ] 計算結果が正しい（電卓で検算）
- [ ] 小数点以下が切り捨てられている
- [ ] カンマ区切りが正しく表示される
- [ ] 通貨記号（¥）が表示される

---

## 7. 考慮事項

### 7.1 技術的考慮事項

#### 7.1.1 パフォーマンス

- **影響**: ほぼなし
- **理由**: 
  - 計算は単純な除算と切り捨て（O(1)）
  - レンダリング時にインラインで計算
  - データ量は年数分のみ（通常10〜50件程度）

#### 7.1.2 保守性

- **メリット**: 
  - シンプルな計算ロジック
  - 既存のデータ構造を変更しない
  - コード変更が最小限
- **デメリット**: 
  - 計算ロジックがJSX内に埋め込まれる
  - 将来、複雑な計算が必要になった場合は関数化が必要

#### 7.1.3 拡張性

**将来的な拡張可能性**:

1. **月別配当金表示機能**
   - 月平均ではなく、実際の月別配当金を表示
   - その場合は`DividendData`型に`monthlyBreakdown`などを追加する必要あり

2. **複数の平均表示**
   - 四半期平均、半期平均など
   - 計算関数を共通化する必要あり

3. **トレンド分析**
   - 前年比、前年差など
   - より複雑なデータ構造が必要

### 7.2 UI/UX考慮事項

#### 7.2.1 可読性

- **メリット**: 
  - 月平均配当額により、配当金の実感が湧きやすい
  - 年間総額だけでは把握しづらい月次収入が明確になる

#### 7.2.2 レスポンシブデザイン

- **確認事項**: 
  - モバイル画面でテーブルが3カラムでも横スクロール可能か
  - カラムの幅が適切に配分されるか
- **既存実装**: 
  - `overflow-x-auto`クラスにより横スクロール対応済み
  - 問題なし

#### 7.2.3 ダークモード

- **確認事項**: 
  - 新規カラムがダークモードでも正しく表示されるか
- **既存実装**: 
  - 既存のスタイルクラスをそのまま使用するため問題なし

---

## 8. リスクと対策

### 8.1 リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 月平均の計算結果がユーザーの期待と異なる（切り捨てではなく四捨五入を期待） | 中 | 低 | ドキュメントやツールチップで計算方法を明記 |
| モバイル表示でテーブルが見づらくなる | 低 | 低 | 既存の横スクロール機能で対応済み |
| 将来的に月別表示が必要になった際の設計変更 | 中 | 中 | その時点でデータ構造を見直す（現時点では過剰設計を避ける） |

### 8.2 実装前のチェックリスト

- [ ] `page.tsx`のテーブルヘッダー部分を確認
- [ ] `page.tsx`のテーブルデータ部分を確認
- [ ] 既存のスタイルクラスを把握
- [ ] 既存のテストケースを確認
- [ ] モバイル表示の動作を確認

### 8.3 実装後のチェックリスト

- [ ] 単体テストの作成・実行
- [ ] ライトモードでの表示確認
- [ ] ダークモードでの表示確認
- [ ] モバイル表示での確認
- [ ] 為替レート変更時の動作確認
- [ ] 計算結果の正確性確認（電卓で検算）
- [ ] コードレビュー
- [ ] ドキュメント更新（必要に応じて）

---

## 9. 実装スケジュール（想定）

| フェーズ | 作業内容 | 想定工数 |
|---------|---------|---------|
| 1. 仕様確認 | 本ドキュメントのレビューと承認 | 0.5h |
| 2. 実装 | `page.tsx`の変更 | 0.5h |
| 3. テスト作成 | 単体テストの追加 | 1.0h |
| 4. テスト実行 | 自動テスト・手動テスト | 0.5h |
| 5. レビュー | コードレビューと修正 | 0.5h |
| **合計** | | **3.0h** |

---

## 10. 参考資料

### 10.1 関連ドキュメント

- [開発者向けアプリ仕様書](./developer-specification.md)
- [改善点リスト](./improvements.md)

### 10.2 関連コード

- **メインページ**: `src/app/page.tsx`
- **型定義**: `src/app/page.tsx` (22-40行目)
- **テーブル実装**: `src/app/page.tsx` (311-342行目)

---

## 11. 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|---------|--------|
| 2026-02-06 | 1.0 | 初版作成 | GitHub Copilot |

---

## 12. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| 仕様作成者 | | 2026-02-06 | |
| レビュアー | | | |
| 承認者 | | | |
