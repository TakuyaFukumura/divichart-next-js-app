# データがない場合の表示改善仕様書

## ドキュメント概要

このドキュメントでは、divichart-next-js-appにおいてCSVデータが0件の場合の表示改善について検討し、実装仕様を定義します。

## 作成日

2026年2月12日

---

## 1. 背景と問題点

### 1.1 現状の課題

配当金データ可視化アプリケーションにおいて、CSVファイルから読み込んだデータが0件の場合、以下の問題が発生しています。

**問題点:**
1. 空のグラフが表示される（軸とグリッドのみ）
2. 空のテーブルが表示される（ヘッダーのみ）
3. ユーザーが何をすべきか分からない
4. エラーなのか正常なのか判断できない
5. ユーザーエクスペリエンスの低下

### 1.2 影響範囲

以下のページで問題が発生しています：

1. **年別配当ページ** (`/`)
   - 棒グラフが空で表示される
   - 年別配当金集計テーブルが空で表示される

2. **累計配当ページ** (`/cumulative`)
   - 折れ線グラフが空で表示される
   - 年別累計配当金集計テーブルが空で表示される

### 1.3 既に対応済みの箇所

以下のコンポーネントは既に空データ対応が実装されています：

1. **配当ポートフォリオページ** (`/portfolio`)
   - データがない場合、専用メッセージを表示
   - 実装箇所: `src/app/portfolio/page.tsx` (83-99行目)

2. **配当テーブルコンポーネント** (`DividendTable`)
   - データがない場合、「表示する配当データがありません」を表示
   - 実装箇所: `src/app/components/DividendTable.tsx` (18-26行目)

---

## 2. 要件定義

### 2.1 機能要件

#### 2.1.1 空データの検出

以下の条件を満たす場合、「データなし」状態として扱います：

- CSVファイルが正常に読み込まれている（エラーではない）
- 読み込まれたデータの配列が空（`data.length === 0`）
- または、フィルタリング後のデータが空

#### 2.1.2 表示内容

データがない場合、以下の情報を表示します：

1. **メインメッセージ**
   - 明確で分かりやすい日本語メッセージ
   - 例: 「表示する配当データがありません」

2. **状況説明（オプション）**
   - データがない理由や対処方法を簡潔に説明
   - 例: 「CSVファイルにデータが含まれていないか、選択した期間にデータがありません」

3. **視覚的なフィードバック**
   - アイコンやイラストで視覚的に分かりやすく表示
   - 既存のデザインシステムと統一感を持たせる

### 2.2 非機能要件

#### 2.2.1 デザイン要件

1. **一貫性**
   - 既存の空データ表示（ポートフォリオページ、配当テーブル）と統一感を持たせる
   - 同じスタイリングパターンを使用

2. **ダークモード対応**
   - ライトモードとダークモードの両方で適切に表示される
   - `dark:` プレフィックスを使用したTailwind CSSクラス

3. **レスポンシブデザイン**
   - モバイル、タブレット、デスクトップで適切に表示される

#### 2.2.2 パフォーマンス要件

1. データ検証処理は軽量であること
2. 空データ表示への切り替えは即座に行われること

#### 2.2.3 保守性要件

1. コードの可読性を維持
2. 既存のコンポーネント構造を可能な限り維持
3. 適切なコメントとドキュメント

---

## 3. 設計

### 3.1 アーキテクチャ

既存の実装パターンを踏襲し、以下の構造で実装します：

```typescript
if (loading) return <LoadingScreen />;
if (error) return <ErrorScreen error={error} />;
if (data.length === 0) return <EmptyDataMessage />; // 追加

// 通常の表示
return <NormalView />;
```

### 3.2 空データメッセージコンポーネント

#### 3.2.1 コンポーネント配置

空データメッセージは、各ページ内にインラインで実装します。
理由：
- ページごとに微妙にメッセージを変える必要がある
- シンプルな実装で済む
- 既存のポートフォリオページと同じパターン

#### 3.2.2 表示内容の詳細

**年別配当ページ (`/`)**
```
タイトル: 年別配当
メッセージ: 表示する配当データがありません
```

**累計配当ページ (`/cumulative`)**
```
タイトル: 累計配当
メッセージ: 表示する配当データがありません
```

### 3.3 スタイリング仕様

既存の実装を参考に、以下のTailwind CSSクラスを使用します：

```tsx
<div className="bg-gray-50 dark:bg-gray-900 rounded-xl p-6">
  <p className="text-gray-500 dark:text-gray-400 text-center">
    表示する配当データがありません
  </p>
</div>
```

### 3.4 実装箇所

#### 3.4.1 年別配当ページ (`src/app/page.tsx`)

以下の位置に空データチェックを追加：

```typescript
// line 64-65
if (loading) return <LoadingScreen />;
if (error) return <ErrorScreen error={error} />;

// ここに追加
if (data.length === 0) {
  return (
    <div className="min-h-screen bg-linear-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-8">
      <div className="max-w-6xl mx-auto">
        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-6 text-gray-800 dark:text-gray-200">
            年別配当
          </h1>
          <div className="bg-gray-50 dark:bg-gray-900 rounded-xl p-6">
            <p className="text-gray-500 dark:text-gray-400 text-center">
              表示する配当データがありません
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

// 通常の表示 (line 94-)
return (
  <div className="min-h-screen ...">
```

#### 3.4.2 累計配当ページ (`src/app/cumulative/page.tsx`)

以下の位置に空データチェックを追加：

```typescript
// line 53-54
if (loading) return <LoadingScreen />;
if (error) return <ErrorScreen error={error} />;

// ここに追加
if (data.length === 0) {
  return (
    <div className="min-h-screen bg-linear-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-8">
      <div className="max-w-6xl mx-auto">
        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-6 text-gray-800 dark:text-gray-200">
            累計配当
          </h1>
          <div className="bg-gray-50 dark:bg-gray-900 rounded-xl p-6">
            <p className="text-gray-500 dark:text-gray-400 text-center">
              表示する配当データがありません
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

// 通常の表示 (line 56-)
return (
  <div className="min-h-screen ...">
```

---

## 4. テスト計画

### 4.1 単体テスト

以下のテストケースを追加します：

#### 4.1.1 年別配当ページ

1. **データが空の場合**
   - `data.length === 0` のとき、空データメッセージが表示される
   - グラフとテーブルが表示されない

2. **データがある場合**
   - `data.length > 0` のとき、通常通りグラフとテーブルが表示される

#### 4.1.2 累計配当ページ

1. **データが空の場合**
   - `data.length === 0` のとき、空データメッセージが表示される
   - グラフとテーブルが表示されない

2. **データがある場合**
   - `data.length > 0` のとき、通常通りグラフとテーブルが表示される

### 4.2 結合テスト

1. **空のCSVファイル読み込み**
   - 空のCSVファイルを読み込んだ場合、適切にメッセージが表示される

2. **ダークモード切り替え**
   - ライトモードとダークモードで適切にスタイルが適用される

3. **レスポンシブ表示**
   - モバイル、タブレット、デスクトップで適切に表示される

### 4.3 手動テスト

1. **視覚的確認**
   - 実際にブラウザで表示を確認
   - スクリーンショットを取得して記録

2. **ユーザビリティ確認**
   - メッセージが分かりやすいか
   - デザインが統一されているか

---

## 5. 実装の優先順位

### 5.1 Phase 1: 最小限の実装（必須）

1. 年別配当ページの空データ対応
2. 累計配当ページの空データ対応

### 5.2 Phase 2: 拡張（オプション、将来の改善）

以下は今回の実装範囲外ですが、将来的に検討する価値がある改善案です：

1. **詳細な説明の追加**
   - データがない理由の詳細説明
   - データを追加する方法のガイド

2. **アクションボタンの追加**
   - 「サンプルデータを読み込む」ボタン
   - 「ファイルを選択」ボタン（将来的なファイルアップロード機能）

3. **イラストやアイコンの追加**
   - より視覚的に分かりやすいUI
   - empty state illustrations

4. **アニメーション**
   - フェードイン効果
   - より洗練されたUX

---

## 6. 考慮事項

### 6.1 データフロー

```
CSVファイル読み込み
  ↓
useDividendData hook
  ↓
rawData (CSVRow[])
  ↓
データ加工・集計
  ↓
data (DividendData[] or CumulativeDividendData[])
  ↓
空データチェック ← ここで判定
  ↓
表示（通常表示 or 空データメッセージ）
```

**チェックポイント:**
- `rawData.length === 0` ではなく、加工後の `data.length === 0` でチェック
- 理由: 加工・フィルタリング後に空になる可能性があるため

### 6.2 エラー処理との違い

| 状態 | 判定条件 | 表示 |
|------|---------|------|
| ローディング中 | `loading === true` | LoadingScreen |
| エラー | `error !== null` | ErrorScreen |
| **空データ** | **`data.length === 0`** | **空データメッセージ** |
| 正常（データあり） | `data.length > 0` | 通常表示 |

### 6.3 パフォーマンス

- `data.length === 0` のチェックは O(1) で非常に高速
- 空データ時は重いグラフ描画処理がスキップされるため、むしろパフォーマンスが向上

### 6.4 アクセシビリティ

- メッセージは `text-center` で中央揃え
- コントラスト比は WCAG AA 基準を満たす
- スクリーンリーダーで読み上げ可能

---

## 7. 実装後の確認事項

### 7.1 チェックリスト

実装完了後、以下を確認します：

- [ ] 年別配当ページで空データメッセージが表示される
- [ ] 累計配当ページで空データメッセージが表示される
- [ ] ライトモードで適切に表示される
- [ ] ダークモードで適切に表示される
- [ ] モバイルで適切に表示される
- [ ] タブレットで適切に表示される
- [ ] デスクトップで適切に表示される
- [ ] 既存のテストが全て通る
- [ ] 新規テストを追加し、通る
- [ ] ESLintエラーがない
- [ ] TypeScriptコンパイルエラーがない
- [ ] ビルドが成功する
- [ ] ファイル末尾に改行がある

### 7.2 スクリーンショット

実装後、以下のスクリーンショットを撮影して記録します：

1. 年別配当ページ（空データ、ライトモード）
2. 年別配当ページ（空データ、ダークモード）
3. 累計配当ページ（空データ、ライトモード）
4. 累計配当ページ（空データ、ダークモード）

---

## 8. まとめ

### 8.1 実装のポイント

1. **最小限の変更**
   - 既存のコードを可能な限り変更しない
   - 既存のパターンを踏襲する

2. **一貫性**
   - ポートフォリオページと同じデザインパターン
   - 配当テーブルコンポーネントと同じメッセージスタイル

3. **シンプル**
   - 複雑な条件分岐を避ける
   - 理解しやすいコード

### 8.2 期待される効果

1. **ユーザビリティ向上**
   - ユーザーが状況を理解できる
   - 混乱が減る

2. **品質向上**
   - エッジケースへの対応
   - より堅牢なアプリケーション

3. **保守性向上**
   - 一貫性のあるコード
   - 将来の拡張が容易

---

## 9. 参考資料

- [doc/feature-addition-consideration.md](./feature-addition-consideration.md) - 機能追加検討
- [doc/developer-specification.md](./developer-specification.md) - 開発者向け仕様書
- [README.md](../README.md) - プロジェクト概要

---

## 10. 変更履歴

- 2026年2月12日: 初版作成
