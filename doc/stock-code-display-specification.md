# 配当ポートフォリオ画面 銘柄コード表示機能 仕様書

## 1. ドキュメント情報

- **作成日**: 2026年2月6日
- **ドキュメント種別**: 機能仕様書
- **対象機能**: 配当ポートフォリオ画面の銘柄コード表示
- **対象読者**: 開発者、レビュアー、プロジェクト関係者
- **関連ドキュメント**: [dividend-portfolio-specification.md](./dividend-portfolio-specification.md)

---

## 2. 概要

### 2.1 目的

配当ポートフォリオ画面下部の銘柄別配当内訳テーブルに銘柄コード（ティッカーシンボル）を表示することで、ユーザーが各銘柄を一意に識別しやすくする。特に米国株式などでは正式名称よりも銘柄コードの方が一般的に認知されているため、ユーザビリティが向上する。

### 2.2 背景

- 現在のCSVデータには「銘柄コード」列が含まれているが、画面上には表示されていない
- 米国株式（例: "BLV", "VCLT"）は銘柄コードで識別されることが多い
- 投資信託などの一部商品には銘柄コードが設定されていない（空文字列）
- 銘柄コードを表示することで、銘柄の検索や識別が容易になる

### 2.3 対象範囲

- **対象画面**: 配当ポートフォリオ画面（`/portfolio`）
- **対象要素**: 画面下部の配当内訳テーブル
- **対象データ**: CSVファイルの「銘柄コード」列

---

## 3. 現状分析

### 3.1 CSVデータ構造

配当金データのCSVファイルには以下のカラムが含まれています：

```csv
入金日,商品,口座,銘柄コード,銘柄,受取通貨,単価[円/現地通貨],数量[株/口],配当・分配金合計（税引前）[円/現地通貨],税額合計[円/現地通貨],受取金額[円/現地通貨]
```

**銘柄コード列（4列目）の特徴**:

1. **米国株式**: 通常はティッカーシンボル（例: "BLV", "VCLT", "XYLD", "PSEC"）
2. **投資信託**: 多くの場合、空文字列（例: ""）
3. **その他の資産**: 商品によって異なる

**実データの例**:

| 銘柄コード | 銘柄                            | 商品   |
|-------|-------------------------------|------|
| BLV   | VA L-TERM BOND                | 米国株式 |
| VCLT  | VA L-TERM CORPBD              | 米国株式 |
| ""    | ブラジル株式ツインαファンド(毎月分配型)ツインα・コース | 投資信託 |
| ""    | インデックスファンドMLP(毎月分配型)          | 投資信託 |
| PFFD  | GBLX US PREFERRD              | 米国株式 |

### 3.2 現在のテーブル構造

**現行の配当内訳テーブル**:

| カラム名    | 説明         | 配置  | フォーマット   |
|---------|------------|-----|----------|
| 銘柄名     | 銘柄の正式名称    | 左寄せ | テキスト     |
| 配当金額[円] | 税引後の配当金額   | 右寄せ | 3桁カンマ区切り |
| 割合[%]   | 全体に対する配当割合 | 右寄せ | 小数点1桁    |

**課題**:

- 銘柄コードが表示されていないため、米国株式などの識別が銘柄名のみに依存している
- 同じような名称の銘柄が複数ある場合に区別しにくい
- ユーザーが証券会社の管理画面や他のツールとデータを照合する際に不便

---

## 4. 要件定義

### 4.1 機能要件

#### FR-1: 銘柄コードカラムの追加

- **要件**: テーブルに銘柄コード列を追加する
- **優先度**: 必須
- **詳細**:
    - CSVデータの「銘柄コード」列の値を表示する
    - 銘柄名の前（左側）に配置する

#### FR-2: 銘柄コードがない場合の表示

- **要件**: 銘柄コードが空の場合は適切な代替表示をする
- **優先度**: 必須
- **詳細**:
    - 銘柄コードが空文字列の場合は「-」（ハイフン）を表示する
    - 視覚的にデータが「ない」ことが明確になるようにする

#### FR-3: データ型の追加

- **要件**: TypeScript型定義に銘柄コード情報を追加する
- **優先度**: 必須
- **詳細**:
    - `CSVRow`型に`銘柄コード`プロパティを追加
    - `StockDividend`型に`stockCode`プロパティを追加

#### FR-4: データ集計ロジックの更新

- **要件**: 配当金集計時に銘柄コードも保持する
- **優先度**: 必須
- **詳細**:
    - 同一銘柄名の配当を合算する際、銘柄コードも一緒に扱う
    - 銘柄コードが異なる場合は別の銘柄として扱う

### 4.2 非機能要件

#### NFR-1: パフォーマンス

- テーブル表示のパフォーマンスに影響を与えない
- 既存の表示速度を維持する

#### NFR-2: レスポンシブ対応

- モバイル、タブレット、デスクトップの各サイズで適切に表示される
- 小画面では横スクロールで全カラムを表示可能にする

#### NFR-3: アクセシビリティ

- スクリーンリーダーで銘柄コード列のヘッダーが適切に読み上げられる
- キーボードナビゲーションが正常に機能する

#### NFR-4: 後方互換性

- 既存のCSVファイルがそのまま使用できる
- 銘柄コード列がないCSVファイルでもエラーが発生しない（全て"-"表示）

---

## 5. UI/UX 設計

### 5.1 テーブルカラム構成案

#### 案A: 銘柄コードを銘柄名の前に配置（推奨案）

| 銘柄コード | 銘柄名                           | 配当金額[円]  | 割合[%] |
|-------|-------------------------------|----------|-------|
| BLV   | VA L-TERM BOND                | ¥150,000 | 35.7  |
| VCLT  | VA L-TERM CORPBD              | ¥100,000 | 23.8  |
| -     | ブラジル株式ツインαファンド(毎月分配型)ツインα・コース | ¥50,000  | 11.9  |
| PFFD  | GBLX US PREFERRD              | ¥30,000  | 7.1   |
| -     | インデックスファンドMLP(毎月分配型)          | ¥20,000  | 4.8   |
| -     | その他                           | ¥70,000  | 16.7  |

**メリット**:

- 銘柄コードで素早く識別できる
- 銘柄コードがある場合とない場合が明確に区別される
- 一般的な株式ポートフォリオ表示の慣習に従っている

**デメリット**:

- カラム数が増えることで横幅が広がる
- モバイル表示では横スクロールが必要になる可能性がある

### 5.2 推奨案の選定

**推奨: 案A（銘柄コードを独立したカラムとして配置）**

**選定理由**:

1. **視認性**: 銘柄コードと銘柄名が明確に区別され、視認性が高い
2. **ソート・フィルタリング**: 将来的な機能拡張（ソート、検索）に対応しやすい
3. **一貫性**: 証券会社の管理画面や一般的なポートフォリオツールと同じ表示形式
4. **スケーラビリティ**: カラム数が増えてもレスポンシブデザインで対応可能
5. **データの明確性**: 銘柄コードがある/なしが"-"で明確に示される

### 5.3 更新後のテーブル詳細仕様

#### カラム構成（案A採用）

| カラム名    | 説明         | 配置  | 幅の割合 | フォーマット    |
|---------|------------|-----|------|-----------|
| 銘柄コード   | ティッカーシンボル  | 左寄せ | 10%  | テキスト（大文字） |
| 銘柄名     | 銘柄の正式名称    | 左寄せ | 50%  | テキスト      |
| 配当金額[円] | 税引後の配当金額   | 右寄せ | 20%  | 3桁カンマ区切り  |
| 割合[%]   | 全体に対する配当割合 | 右寄せ | 20%  | 小数点1桁     |

#### スタイリング詳細

**ヘッダー行**:

```tsx
<th className="px-6 py-3 text-left text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
    銘柄コード
</th>
```

**データ行（銘柄コードあり）**:

```tsx
<td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-300 text-left">
    BLV
</td>
```

**データ行（銘柄コードなし）**:

```tsx
<td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-500 text-left">
    -
</td>
```

**「その他」行の特別扱い**:

```tsx
<td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-500 text-left italic">
    -
</td>
```

### 5.4 モックアップ

#### デスクトップ表示（推奨案A）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  配当内訳一覧                                                                   │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │ 銘柄コード │ 銘柄名                              │ 金額[円]   │ 割合[%] │  │
│  ├───────────────────────────────────────────────────────────────────────┤  │
│  │ BLV       │ VA L-TERM BOND                     │  150,000   │  35.7   │  │
│  │ VCLT      │ VA L-TERM CORPBD                   │  100,000   │  23.8   │  │
│  │ -         │ ブラジル株式ツインαファンド(毎月分配型)  │   50,000   │  11.9   │  │
│  │ PFFD      │ GBLX US PREFERRD                   │   30,000   │   7.1   │  │
│  │ -         │ インデックスファンドMLP(毎月分配型)     │   20,000   │   4.8   │  │
│  │ -         │ その他                              │   70,000   │  16.7   │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### モバイル表示（横スクロール対応）

```
┌───────────────────────────────┐
│  配当内訳一覧                   │
│  ┌────────────────────────┐   │
│  │ 銘柄コード │ 銘柄名      →  │   │
│  ├────────────────────────┤   │
│  │ BLV       │ VA L-TERM  →  │   │
│  │ VCLT      │ VA L-TERM  →  │   │
│  │ -         │ ブラジル株式  →  │   │
│  └────────────────────────┘   │
│        ← スクロール可能 →         │
└───────────────────────────────┘
```

---

## 6. データ構造設計

### 6.1 TypeScript型定義の更新

#### 更新前（現行）

```typescript
/**
 * CSVファイルの行データ型定義
 */
type CSVRow = {
    /** 入金日（YYYY/MM/DD形式） */
    '入金日': string;
    /** 受取通貨（例: "円", "USドル"） */
    '受取通貨': string;
    /** 受取金額（現地通貨）の文字列表現 */
    '受取金額[円/現地通貨]': string;
    /** 銘柄名 */
    '銘柄': string;
};

/**
 * 銘柄別配当データ
 */
type StockDividend = {
    /** 銘柄名 */
    stockName: string;
    /** 配当金額（税引き後）[円] */
    amount: number;
    /** 配当割合 [%] */
    percentage: number;
    /** 色コード（円グラフ用） */
    color?: string;
};
```

#### 更新後（提案）

```typescript
/**
 * CSVファイルの行データ型定義
 * 配当金リストのCSVファイルから読み込まれるデータの形式
 */
type CSVRow = {
    /** 入金日（YYYY/MM/DD形式） */
    '入金日': string;
    /** 商品（例: "米国株式", "投資信託"） */
    '商品': string;
    /** 口座（例: "旧NISA", "特定", "新NISA"） */
    '口座': string;
    /** 銘柄コード（ティッカーシンボル等、空の場合あり） */
    '銘柄コード': string;
    /** 銘柄名 */
    '銘柄': string;
    /** 受取通貨（例: "円", "USドル"） */
    '受取通貨': string;
    /** 単価（現地通貨）の文字列表現 */
    '単価[円/現地通貨]': string;
    /** 数量（株数または口数）の文字列表現 */
    '数量[株/口]': string;
    /** 配当・分配金合計（税引前）[円/現地通貨] */
    '配当・分配金合計（税引前）[円/現地通貨]': string;
    /** 税額合計[円/現地通貨] */
    '税額合計[円/現地通貨]': string;
    /** 受取金額（税引後、現地通貨）の文字列表現 */
    '受取金額[円/現地通貨]': string;
};

/**
 * 銘柄別配当データ
 */
type StockDividend = {
    /** 銘柄コード（ティッカーシンボル等、空の場合は空文字列） */
    stockCode: string;
    /** 銘柄名 */
    stockName: string;
    /** 配当金額（税引き後）[円] */
    amount: number;
    /** 配当割合 [%] */
    percentage: number;
    /** 色コード（円グラフ用） */
    color?: string;
};
```

### 6.2 データ集計ロジックの更新

#### 銘柄コードを含めた集計キーの生成

```typescript
/**
 * 銘柄を一意に識別するためのキーを生成
 *
 * @param stockCode - 銘柄コード
 * @param stockName - 銘柄名
 * @returns 一意な識別キー
 *
 * @remarks
 * - 銘柄コードがある場合: "{銘柄コード}:{銘柄名}"
 * - 銘柄コードがない場合: "NO_CODE:{銘柄名}"
 * - これにより、同じ銘柄名でも銘柄コードが異なる場合は別銘柄として扱われる
 */
function generateStockKey(stockCode: string, stockName: string): string {
    const code = stockCode.trim();
    return code ? `${code}:${stockName}` : `NO_CODE:${stockName}`;
}
```

#### 更新後の集計ロジック

```typescript
/**
 * 指定年の銘柄別配当金を集計する
 *
 * @param csvData - CSVから読み込んだ配当データ
 * @param targetYear - 集計対象年
 * @param exchangeRate - USドル→円の為替レート
 * @returns 銘柄別配当データの配列（降順ソート済み）
 */
function calculateStockDividends(
    csvData: CSVRow[],
    targetYear: number,
    exchangeRate: number
): StockDividend[] {
    // 銘柄別に配当金を集計（銘柄コード+銘柄名をキーとする）
    const stockDividends: Map<string, {
        stockCode: string;
        stockName: string;
        amount: number;
    }> = new Map();

    csvData.forEach((row) => {
        const dateStr = row['入金日'];
        const stockCode = row['銘柄コード'] || '';
        const stockName = row['銘柄'] || '';
        const currency = row['受取通貨'];
        const amountStr = row['受取金額[円/現地通貨]'];

        if (!dateStr || !amountStr) return;

        // 指定年のデータのみを対象とする
        const year = parseInt(dateStr.split('/')[0], 10);
        if (year !== targetYear) return;

        // 金額を数値に変換
        const amountValue = amountStr === '-' ? 0 : parseFloat(amountStr.replace(/,/g, ''));
        if (isNaN(amountValue)) return;

        // USドルの場合は円に換算
        let amountInYen = amountValue;
        if (currency === 'USドル') {
            amountInYen = amountValue * exchangeRate;
        }

        // 一意なキーを生成
        const key = generateStockKey(stockCode, stockName);

        // 銘柄別に集計
        const existing = stockDividends.get(key);
        if (existing) {
            existing.amount += amountInYen;
        } else {
            stockDividends.set(key, {
                stockCode: stockCode,
                stockName: stockName,
                amount: amountInYen,
            });
        }
    });

    // 合計金額を計算
    const totalAmount = Array.from(stockDividends.values())
        .reduce((sum, stock) => sum + stock.amount, 0);

    // 金額の降順でソートし、割合を計算
    const sortedStocks: StockDividend[] = Array.from(stockDividends.values())
        .sort((a, b) => b.amount - a.amount)
        .map((stock) => ({
            stockCode: stock.stockCode,
            stockName: stock.stockName,
            amount: Math.round(stock.amount),
            percentage: totalAmount === 0 ? 0 : (stock.amount / totalAmount) * 100,
        }));

    return sortedStocks;
}
```

### 6.3 「その他」の集約における銘柄コードの扱い

「その他」として集約される場合、銘柄コードは空文字列とする。

```typescript
/**
 * 上位N件以外を「その他」に集約
 *
 * @param stocks - 銘柄別配当データ（ソート済み）
 * @param topN - 個別表示する銘柄数（デフォルト: 10）
 * @returns 「その他」集約後の銘柄別配当データ
 */
function aggregateOthers(
    stocks: StockDividend[],
    topN: number = 10
): StockDividend[] {
    if (stocks.length <= topN) {
        return stocks;
    }

    const totalAmount = stocks.reduce((sum, s) => sum + s.amount, 0);

    const topStocks = stocks.slice(0, topN);
    const otherStocks = stocks.slice(topN);

    const otherAmount = otherStocks.reduce((sum, s) => sum + s.amount, 0);
    const otherPercentage = totalAmount === 0 ? 0 : (otherAmount / totalAmount) * 100;

    return [
        ...topStocks,
        {
            stockCode: '', // 「その他」は銘柄コードなし
            stockName: 'その他',
            amount: otherAmount,
            percentage: otherPercentage,
            color: '#9ca3af', // グレー系の色
        }
    ];
}
```

---

## 7. 実装計画

### 7.1 影響範囲の分析

#### 変更が必要なファイル

1. **型定義の更新**:
    - `src/types/dividend.ts` (新規作成) または既存のファイルに型定義を追加
    - `CSVRow`型に全CSVカラムを追加
    - `StockDividend`型に`stockCode`プロパティを追加

2. **データ処理ロジックの更新**:
    - `src/lib/dividendCalculator.ts` (新規作成予定)
    - 銘柄コードを含めた集計ロジックの実装
    - `generateStockKey`関数の追加

3. **UIコンポーネントの更新**:
    - `src/app/components/DividendTable.tsx` (新規作成予定)
    - テーブルに銘柄コードカラムを追加
    - 銘柄コードが空の場合は"-"を表示

4. **ページコンポーネントの更新**:
    - `src/app/portfolio/page.tsx` (新規作成予定)
    - 銘柄コードデータの受け渡し

5. **スタイリング**:
    - Tailwind CSSクラスの調整（カラム幅、レスポンシブ対応）

#### 変更が不要なファイル

- CSVファイル（`public/data/dividendlist_*.csv`）: 既に銘柄コード列が含まれている
- `src/app/components/Header.tsx`: ナビゲーションのみで変更不要
- `src/app/layout.tsx`: レイアウトに変更なし
- `src/app/page.tsx`: 既存の年別配当グラフページには影響なし

### 7.2 実装ステップ

#### ステップ1: 型定義の更新（優先度: 高）

**作業内容**:

- `CSVRow`型に全カラムを定義
- `StockDividend`型に`stockCode`プロパティを追加

**想定工数**: 30分

**検証方法**:

- TypeScriptコンパイルが通ることを確認
- 型定義のテストを作成（オプション）

#### ステップ2: データ集計ロジックの更新（優先度: 高）

**作業内容**:

- `generateStockKey`関数の実装
- `calculateStockDividends`関数の銘柄コード対応
- `aggregateOthers`関数の更新

**想定工数**: 1.5時間

**検証方法**:

- ユニットテストを作成
- サンプルデータで集計結果を確認

#### ステップ3: テーブルコンポーネントの更新（優先度: 高）

**作業内容**:

- テーブルに銘柄コードカラムを追加
- 銘柄コードが空の場合の"-"表示ロジック
- レスポンシブ対応（横スクロール）

**想定工数**: 2時間

**検証方法**:

- コンポーネントのレンダリングテスト
- ブラウザでの表示確認（デスクトップ、タブレット、モバイル）

#### ステップ4: ページコンポーネントの更新（優先度: 中）

**作業内容**:

- ポートフォリオページでの銘柄コードデータの受け渡し

**想定工数**: 30分

**検証方法**:

- ページ全体の表示確認
- データフローの確認

#### ステップ5: スタイリングの調整（優先度: 中）

**作業内容**:

- カラム幅の最適化
- ダークモード対応の確認
- レスポンシブ表示の微調整

**想定工数**: 1時間

**検証方法**:

- 各画面サイズでの表示確認
- ダークモード切替の確認

#### ステップ6: テストの追加・更新（優先度: 高）

**作業内容**:

- ユニットテストの作成・更新
- コンポーネントテストの作成・更新

**想定工数**: 2時間

**検証方法**:

- テストカバレッジの確認（目標: 80%以上）
- すべてのテストがパスすることを確認

#### ステップ7: ドキュメントの更新（優先度: 中）

**作業内容**:

- README.mdの更新（スクリーンショット追加）
- developer-specification.mdの更新
- copilot-instructions.mdの更新

**想定工数**: 1時間

**検証方法**:

- ドキュメントの内容確認
- リンク切れのチェック

### 7.3 スケジュール

| ステップ              | 想定工数     | 優先度 | 担当者候補 |
|-------------------|----------|-----|-------|
| 1. 型定義の更新         | 0.5h     | 高   | -     |
| 2. データ集計ロジックの更新   | 1.5h     | 高   | -     |
| 3. テーブルコンポーネントの更新 | 2.0h     | 高   | -     |
| 4. ページコンポーネントの更新  | 0.5h     | 中   | -     |
| 5. スタイリングの調整      | 1.0h     | 中   | -     |
| 6. テストの追加・更新      | 2.0h     | 高   | -     |
| 7. ドキュメントの更新      | 1.0h     | 中   | -     |
| **合計**            | **8.5h** | -   | -     |

**マイルストーン**:

- **Week 1**: ステップ1〜3の完了
- **Week 2**: ステップ4〜6の完了、テスト実施
- **Week 3**: ステップ7の完了、リリース準備

---

## 8. テスト計画

### 8.1 ユニットテスト

#### 8.1.1 データ集計ロジックのテスト

**対象**: `dividendCalculator.ts` の各関数

**テストケース**:

1. **generateStockKey関数**
    - 銘柄コードありの場合: `"BLV:VA L-TERM BOND"` が返される
    - 銘柄コードなしの場合: `"NO_CODE:銘柄名"` が返される
    - 銘柄コードが空白の場合: `"NO_CODE:銘柄名"` が返される

2. **calculateStockDividends関数**
    - 銘柄コードが異なる同名銘柄を別として扱う
    - 銘柄コードが同じ銘柄を正しく合算する
    - 銘柄コードがない投資信託を正しく処理する

3. **aggregateOthers関数**
    - 「その他」の銘柄コードが空文字列になる
    - 上位N件が正しく選択される

### 8.2 コンポーネントテスト

#### 8.2.1 DividendTableコンポーネントのテスト

**テストケース**:

1. **銘柄コードカラムの表示**
    - 銘柄コードありの行に正しいコードが表示される
    - 銘柄コードなしの行に"-"が表示される
    - ヘッダーに"銘柄コード"が表示される

2. **データの表示順序**
    - 銘柄が配当金額の降順で表示される
    - 「その他」が最後に表示される

3. **スタイリング**
    - 銘柄コードカラムが左寄せになっている
    - 銘柄コードなしの"-"がグレー色で表示される
    - ダークモードで適切な色が適用される

### 8.3 インテグレーションテスト

**テストシナリオ**:

1. **CSV読み込み → 集計 → 表示の完全なフロー**
    - CSVファイルから銘柄コードを含むデータを読み込む
    - 銘柄別に正しく集計される
    - テーブルに銘柄コードが表示される

2. **レスポンシブ表示**
    - デスクトップサイズで全カラムが表示される
    - モバイルサイズで横スクロールが有効になる

### 8.4 E2Eテスト（オプション）

Playwrightを使用したE2Eテスト:

1. **ポートフォリオページの表示**
    - ページにアクセスする
    - テーブルが表示される
    - 銘柄コードカラムが存在する

2. **データの確認**
    - 銘柄コードありの行にコードが表示される
    - 銘柄コードなしの行に"-"が表示される

### 8.5 テストカバレッジ目標

- **ライン カバレッジ**: 85%以上
- **ブランチ カバレッジ**: 80%以上
- **関数 カバレッジ**: 90%以上

---

## 9. リスクと対策

### 9.1 技術的リスク

#### リスク1: データの不整合

**内容**: 銘柄コードと銘柄名の組み合わせが一意でない場合

**影響度**: 中

**対策**:

- `generateStockKey`関数で銘柄コードと銘柄名の両方をキーにする
- CSVデータの品質チェックを行う（オプション）

#### リスク2: パフォーマンスの低下

**内容**: カラム追加によりテーブルのレンダリングが遅くなる

**影響度**: 低

**対策**:

- `React.memo`でコンポーネントをメモ化
- 大量データがある場合はページネーションを実装（将来的）

#### リスク3: レスポンシブ対応の複雑化

**内容**: モバイル表示でカラムが多すぎて見にくくなる

**影響度**: 中

**対策**:

- 横スクロールを有効にする
- 将来的にはカラムの表示/非表示切替機能を検討

### 9.2 運用リスク

#### リスク4: 既存CSVファイルとの互換性

**内容**: 古いCSVファイルに銘柄コード列がない場合

**影響度**: 低

**対策**:

- 銘柄コード列がない場合は全て空文字列として扱う
- PapaParse の `transformHeader` オプションで対応

#### リスク5: ユーザー混乱

**内容**: 新しいカラムが追加されることによるユーザーの混乱

**影響度**: 低

**対策**:

- ドキュメント（README）にスクリーンショット付きで説明を追加
- リリースノートで変更内容を明記

---

## 10. 将来的な拡張案

### 10.1 銘柄コードによるフィルタリング

銘柄コードで検索・フィルタリングできる機能を追加。

**例**: "BLV"と入力すると、該当銘柄のみを表示

### 10.2 銘柄コードへのリンク

銘柄コードをクリックすると、証券会社や株価サイトの銘柄ページを開く。

**例**: "BLV" をクリック → Yahoo! Financeの BLV ページへ遷移

### 10.3 銘柄コードによるソート

銘柄コードでアルファベット順にソートできる機能。

### 10.4 銘柄コードの編集機能

ユーザーが銘柄コードを手動で追加・編集できる機能（投資信託など）。

### 10.5 銘柄コードの自動補完

銘柄名から銘柄コードを自動的に補完する機能（外部APIの利用）。

---

## 11. 参考資料

### 11.1 関連ドキュメント

- [dividend-portfolio-specification.md](./dividend-portfolio-specification.md): 配当ポートフォリオ機能の全体仕様
- [developer-specification.md](./developer-specification.md): 開発者向け仕様書
- [README.md](../README.md): プロジェクト概要

### 11.2 技術参考

- [Recharts Documentation](https://recharts.org/): グラフライブラリ
- [Tailwind CSS - Tables](https://tailwindcss.com/docs/table-layout): テーブルスタイリング
- [PapaParse Documentation](https://www.papaparse.com/docs): CSV解析ライブラリ

### 11.3 デザイン参考

- [証券会社のポートフォリオ画面の例](https://www.sbi.jp/): 一般的な銘柄コード表示
- [Yahoo! Finance](https://finance.yahoo.com/): 銘柄コード表示の標準

---

## 12. 承認・変更履歴

### 12.1 変更履歴

| 日付         | バージョン | 変更内容 | 作成者       |
|------------|-------|------|-----------|
| 2026/02/06 | 1.0.0 | 初版作成 | プロジェクトチーム |

### 12.2 承認

| 役割    | 氏名 | 承認日        | 署名 |
|-------|----|------------|----|
| 作成者   | -  | 2026/02/06 | -  |
| レビュアー | -  | -          | -  |
| 承認者   | -  | -          | -  |

---

## 13. 付録

### 13.1 用語集

| 用語        | 説明                                     |
|-----------|----------------------------------------|
| 銘柄コード     | 株式や投資信託を一意に識別するためのコード（ティッカーシンボルとも呼ばれる） |
| ティッカーシンボル | 特に米国株式市場で使用される銘柄コードの呼称（例: BLV, AAPL）   |
| 配当金       | 株式を保有することで得られる利益の一部                    |
| 投資信託      | 複数の投資家から資金を集めて運用する金融商品                 |
| 旧NISA     | 少額投資非課税制度（2023年までの制度）                  |
| 新NISA     | 2024年から開始された新しい少額投資非課税制度               |
| Shift-JIS | 日本語を扱うための文字エンコーディング方式の一つ               |

### 13.2 Q&A

**Q1: 銘柄コードがない投資信託はどう表示されますか？**

A1: 銘柄コード列に"-"（ハイフン）が表示されます。これにより、データがないことが明確になります。

**Q2: 同じ銘柄コードで異なる銘柄名がある場合はどうなりますか？**

A2: 通常は発生しないケースですが、銘柄コードと銘柄名の組み合わせで一意に識別されるため、別の銘柄として扱われます。

**Q3: モバイル表示でカラムが多すぎませんか？**

A3: 横スクロールを有効にすることで、すべてのカラムを表示できます。将来的にはカラムの表示/非表示切替機能も検討します。

**Q4: 「その他」の銘柄コードはどう表示されますか？**

A4: 「その他」は複数銘柄の集約であり、特定の銘柄コードを持たないため、"-"が表示されます。

**Q5: 銘柄コードでソートできますか？**

A5: 初期実装では配当金額でのソートのみですが、将来的に銘柄コードソート機能を追加することを検討しています。

---

**本仕様書に関する質問や提案は、GitHubのIssueまたはPull Requestで受け付けています。**

※ 本ドキュメントは GitHub Copilot を含む生成 AI ツールの支援を受けて作成されています。
