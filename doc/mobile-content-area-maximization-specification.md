# スマホ画面のコンテンツ表示領域最大化 - 仕様書

## 文書情報

| 項目 | 内容 |
|------|------|
| 作成日 | 2026年2月13日 |
| 最終更新日 | 2026年2月13日 |
| バージョン | 1.0 |
| 対象 | divichart-next-js-app |
| 関連Issue | スマホ画面のコンテンツ表示領域最大化 |

## 目次

1. [概要](#概要)
2. [現状分析](#現状分析)
3. [問題点の詳細](#問題点の詳細)
4. [改善提案](#改善提案)
5. [実装計画](#実装計画)
6. [リスク評価と対策](#リスク評価と対策)
7. [検証方法](#検証方法)
8. [参考資料](#参考資料)

---

## 概要

### 目的

スマートフォン画面でグラフを閲覧する際、余白が大きすぎてグラフ本体の表示領域が圧迫されている問題を解決し、限られた画面サイズを最大限に活用してグラフの視認性を向上させる。

### 背景

現在のアプリケーションはデスクトップでの閲覧を前提としたレイアウトになっており、モバイル画面では以下の問題が発生している：

- グラフの外側に過剰な余白がある
- グラフ自体の表示領域が狭く、データの視認性が低下している
- テーブル表示も同様に余白が大きく、情報密度が低い

### スコープ

本仕様書では以下の範囲を対象とする：

- **対象画面**: すべてのページ（年別配当、累計配当、ポートフォリオ、目標達成度）
- **対象デバイス**: スマートフォン（画面幅768px未満）
- **対象コンポーネント**: レイアウト、余白、パディング、グラフコンポーネント
- **非対象**: タブレット・デスクトップ画面（既存の表示を維持）

---

## 現状分析

### 現在のレイアウト構造

#### デスクトップ表示（768px以上）

```
┌────────────────────────────────────┐
│ Header (h-16, px-4~8)              │ ← スティッキーヘッダー
├────────────────────────────────────┤
│                                    │
│  ┌──────────────────────────────┐  │
│  │ Container (max-w-6xl, p-8)   │  │ ← 外側の余白
│  │                              │  │
│  │  ┌────────────────────────┐  │  │
│  │  │ Card (p-8)             │  │  │ ← カード内の余白
│  │  │                        │  │  │
│  │  │  ┌──────────────────┐  │  │  │
│  │  │  │ Chart BG (p-6)   │  │  │  │ ← グラフ背景の余白
│  │  │  │                  │  │  │  │
│  │  │  │  ┌────────────┐  │  │  │  │
│  │  │  │  │   Chart    │  │  │  │  │ ← 実際のグラフ
│  │  │  │  └────────────┘  │  │  │  │
│  │  │  └──────────────────┘  │  │  │
│  │  │                        │  │  │
│  │  │  Table (px-6, py-3~4)  │  │  │
│  │  └────────────────────────┘  │  │
│  └──────────────────────────────┘  │
│                                    │
└────────────────────────────────────┘

総余白: Tailwind値ベース → 左右各 8 + 8 + 6 = 22（spacing単位）, px換算（1単位=4pxの場合） → 左右各 32 + 32 + 24 = 88px（合計 176px）
```

#### モバイル表示（768px未満）

```
┌─────────────────┐
│ Header (h-16)   │ ← スティッキーヘッダー（px-4）
├─────────────────┤
│                 │
│ Container (p-8) │ ← 外側の余白（左右各32px）
│ ┌─────────────┐ │
│ │ Card (p-8)  │ │ ← カード内の余白（左右各32px）
│ │             │ │
│ │ ┌─────────┐ │ │
│ │ │ BG (p-6)│ │ │ ← グラフ背景の余白（左右各24px）
│ │ │         │ │ │
│ │ │ ┌─────┐ │ │ │
│ │ │ │Graph│ │ │ │ ← 実際のグラフ
│ │ │ └─────┘ │ │ │
│ │ └─────────┘ │ │
│ └─────────────┘ │
│                 │
└─────────────────┘

総余白: 左右各 32 + 32 + 24 = 88px
画面幅375pxの場合、グラフ幅は約199px（53%）
```

### 現在の余白設定

#### 共通レイアウト（全ページ共通）

| 要素 | クラス | 余白 | 備考 |
|------|--------|------|------|
| 外側コンテナ | `p-8` | 全方向32px | デスクトップと同一 |
| max-widthコンテナ | `max-w-6xl mx-auto` | 中央揃え | デスクトップ用の最大幅 |
| カード | `p-8` | 全方向32px | デスクトップと同一 |
| グラフ背景 | `p-6` | 全方向24px | デスクトップと同一 |
| テーブルセル | `px-6 py-3~4` | 左右24px, 上下12~16px | デスクトップと同一 |

#### ヘッダー（Header.tsx）

| 要素 | クラス | 余白 | 備考 |
|------|--------|------|------|
| ヘッダーコンテナ | `px-4 sm:px-6 lg:px-8` | 左右16~32px | レスポンシブ対応 |
| ヘッダー高さ | `h-16` | 64px | 固定 |

### 実測値（iPhone SE サイズ: 375px × 667px）

スクリーンショット分析結果：

| 項目 | 実測値 | 割合 |
|------|--------|------|
| 画面幅 | 375px | 100% |
| ヘッダー高さ | 64px | - |
| 左右の総余白 | 176px | 47% |
| グラフ表示幅 | 約199px | 53% |
| 上部余白（ヘッダー下） | 約32px | - |
| カード上部余白 | 32px | - |
| グラフ上部余白 | 24px | - |

**問題**: グラフの実表示領域が画面幅の約53%しかなく、残り47%が余白となっている。

---

## 問題点の詳細

### 1. 過剰な余白による表示領域の圧迫

#### 問題の詳細

- **左右の余白が合計176px（画面幅の47%）**: デスクトップと同じ余白設定（p-8 × 3層）がモバイルでも適用されている
- **グラフの実表示幅が約199px（画面幅の53%）**: 狭すぎてデータの視認性が低下
- **縦方向の余白も過剰**: スクロールが頻繁に必要

#### 影響

- グラフの軸ラベルが小さくなり読みにくい
- 複数の年度データが表示される場合、X軸のラベルが重なる可能性がある
- データポイントが密集して判別しにくい
- ユーザーがピンチ操作で拡大する必要がある

### 2. デスクトップとモバイルで同一の余白設定

#### 問題の詳細

Tailwind CSSの`p-8`クラスが全画面サイズで一律に適用されており、モバイル用の調整がない：

```tsx
// 現在の実装例（page.tsx）
<div className="min-h-screen bg-linear-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-8">
    <div className="max-w-6xl mx-auto">
        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
            {/* ... */}
            <div className="bg-gray-50 dark:bg-gray-900 rounded-xl p-6">
                <ResponsiveContainer width="100%" height={400}>
                    {/* Chart */}
                </ResponsiveContainer>
            </div>
        </div>
    </div>
</div>
```

#### 影響

- レスポンシブデザインのベストプラクティスに反する
- モバイルファーストの原則が適用されていない
- 画面サイズごとの最適化が行われていない

### 3. グラフの高さが固定値

#### 問題の詳細

```tsx
<ResponsiveContainer width="100%" height={400}>
```

高さが400pxに固定されており、モバイル画面では以下の問題がある：

- 画面の縦方向の領域に対して相対的に大きい
- アスペクト比が最適化されていない（横幅が狭く、縦が長い）

#### 影響

- グラフが縦長になりすぎて、データが視認しにくい
- 画面に収まらず、スクロールが必要になる

### 4. テーブルの余白も過剰

#### 問題の詳細

```tsx
<td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300 text-right font-mono">
```

セル内の余白（px-6 = 24px）がモバイルでは大きすぎる。

#### 影響

- テーブルが横にはみ出し、横スクロールが必要になる
- 数値の桁数が多い場合、セル内で折り返される可能性がある

### 5. カードの角丸が大きい

#### 問題の詳細

```tsx
className="rounded-2xl"  // 16px
className="rounded-xl"   // 12px
```

#### 影響

- 角丸により、実質的な表示領域がさらに狭くなる（特に小画面で顕著）
- ただし、これはデザインの一部であり、完全に削除すると見栄えが悪くなる可能性

---

## 改善提案

### 改善方針

1. **モバイルファーストアプローチ**: 小画面を優先して設計し、大画面に拡張する
2. **段階的な余白調整**: 画面サイズに応じて余白を動的に調整
3. **コンテンツ優先**: グラフやデータの表示領域を最優先
4. **視認性の維持**: 余白を減らしても、読みやすさを損なわない

### 具体的な改善案

#### 案1: 段階的余白調整（推奨）

Tailwind CSSのレスポンシブプレフィックスを活用し、画面サイズごとに最適な余白を設定する。

##### メリット

- 実装が比較的簡単（クラス名の変更のみ）
- 既存のTailwind設定を活用できる
- デスクトップの表示に影響を与えない
- 段階的に調整できるため、リスクが低い

##### デメリット

- 複数のブレークポイントを管理する必要がある
- クラス名が長くなる

##### 実装案

```tsx
// 外側コンテナ: p-8 → モバイルではp-3
<div className="min-h-screen bg-linear-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-3 sm:p-6 lg:p-8">
    {/* カード: p-8 → モバイルではp-4 */}
    <div className="max-w-6xl mx-auto">
        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-6 lg:p-8">
            {/* タイトル: mb-6 → モバイルではmb-4 */}
            <h1 className="text-3xl sm:text-4xl font-bold mb-4 sm:mb-6 text-gray-800 dark:text-gray-200">
                年別配当
            </h1>
            
            {/* グラフ背景: p-6 → モバイルではp-2 */}
            <div className="bg-gray-50 dark:bg-gray-900 rounded-xl p-2 sm:p-4 lg:p-6">
                <div className="h-[300px] sm:h-[400px]">
                    <ResponsiveContainer width="100%" height="100%">
                        {/* Chart */}
                    </ResponsiveContainer>
                </div>
            </div>
            
            {/* テーブルセクション: mt-8 → モバイルではmt-6 */}
            <div className="mt-6 sm:mt-8">
                <h2 className="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-gray-800 dark:text-gray-200">
                    年別配当金集計
                </h2>
                <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700 border border-gray-200 dark:border-gray-700">
                        <thead className="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                {/* セル: px-6 py-3 → モバイルではpx-3 py-2 */}
                                <th className="px-3 sm:px-6 py-2 sm:py-3 text-right text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                    年
                                </th>
                                {/* ... */}
                            </tr>
                        </thead>
                        <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            {data.map((row) => (
                                <tr key={row.year} className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                    {/* セル: px-6 py-4 → モバイルではpx-3 py-3 */}
                                    <td className="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300 text-right font-mono">
                                        {row.year}
                                    </td>
                                    {/* ... */}
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
```

##### 改善後の余白計算（375px幅の場合）

| 要素 | デスクトップ | モバイル | 削減量 |
|------|-------------|---------|--------|
| 外側コンテナ | 32px | 12px | -20px |
| カード | 32px | 16px | -16px |
| グラフ背景 | 24px | 8px | -16px |
| **左右合計** | **88px** | **36px** | **-52px** |
| **グラフ幅** | **199px (53%)** | **303px (81%)** | **+104px (+28%)** |

**改善効果**: グラフの表示領域が約52%増加

#### 案2: モバイル専用レイアウト（より抜本的）

モバイルでは余白をほぼゼロにし、全画面表示に近い形にする。

##### メリット

- グラフの表示領域を最大化できる
- モバイルアプリのようなUXを提供できる
- より大胆な改善が可能

##### デメリット

- デザインの大幅な変更が必要
- 実装工数が高い
- デスクトップとのデザイン整合性を保つのが難しい
- 余白がなさすぎて、かえって見づらくなる可能性

##### 実装案（概要のみ）

```tsx
// モバイルでは外側の余白をゼロ、カードの角丸も小さく
<div className="min-h-screen bg-linear-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-0 md:p-8">
    <div className="max-w-6xl mx-auto">
        <div className="bg-white dark:bg-gray-800 rounded-none md:rounded-2xl shadow-none md:shadow-lg p-3 md:p-8">
            {/* ... */}
        </div>
    </div>
</div>
```

**注**: この案は改善効果は大きいが、デザインの大幅な変更となるため、慎重な検討が必要。

#### 案3: グラフの高さも調整

グラフの高さを画面サイズに応じて調整し、アスペクト比を最適化する。

##### 実装案

```tsx
// 高さをビューポート高さに応じて動的に設定
<ResponsiveContainer 
    width="100%" 
    height={300}  // モバイル: 300px
    className="sm:h-[400px] lg:h-[450px]"  // デスクトップ: 400-450px
>
    {/* Chart */}
</ResponsiveContainer>
```

または、アスペクト比を使用：

```tsx
<div className="aspect-video sm:aspect-auto">
    <ResponsiveContainer width="100%" height="100%">
        {/* Chart */}
    </ResponsiveContainer>
</div>
```

### 推奨する改善案の組み合わせ

**案1（段階的余白調整）+ 案3（グラフ高さ調整）** を組み合わせた実装を推奨する。

理由：
- 実装が比較的容易
- デザインの大幅な変更を避けられる
- 段階的に改善できる
- デスクトップの表示に影響を与えない
- グラフの視認性を大幅に向上できる

---

## 実装計画

### フェーズ1: 基本的な余白調整（優先度: 高）

#### 対象ファイル

1. `src/app/page.tsx` （年別配当ページ）
2. `src/app/cumulative/page.tsx` （累計配当ページ）
3. 他のページ（ポートフォリオ、目標達成度）も同様のパターンを踏襲

#### 実装内容

1. 外側コンテナの余白を調整: `p-8` → `p-3 sm:p-6 lg:p-8`
2. カード内の余白を調整: `p-8` → `p-4 sm:p-6 lg:p-8`
3. グラフ背景の余白を調整: `p-6` → `p-2 sm:p-4 lg:p-6`
4. タイトルの余白を調整: `mb-6` → `mb-4 sm:mb-6`、`text-4xl` → `text-3xl sm:text-4xl`
5. テーブルセクションの余白を調整: `mt-8` → `mt-6 sm:mt-8`
6. テーブルセルの余白を調整: `px-6 py-3~4` → `px-3 sm:px-6 py-2 sm:py-3~4`

#### 工数見積もり

- 実装: 2-3時間（全ページ）
- テスト: 1時間
- レビュー・調整: 1時間
- **合計: 4-5時間**

### フェーズ2: グラフの高さ調整（優先度: 中）

#### 実装内容

1. グラフの高さをレスポンシブに調整
2. モバイルでは300px、タブレットで350px、デスクトップで400pxに設定

#### 工数見積もり

- 実装: 1時間
- テスト: 30分
- **合計: 1.5時間**

### フェーズ3: ヘッダーの余白調整（優先度: 低）

#### 実装内容

ヘッダーの余白も見直す（現在は`px-4 sm:px-6 lg:px-8`）

#### 工数見積もり

- 実装: 30分
- テスト: 30分
- **合計: 1時間**

### 総工数見積もり

**合計: 6.5時間（1日弱）**

---

## リスク評価と対策

### リスク1: デザインのバランスが崩れる

#### リスクレベル: 中

#### 内容

余白を減らしすぎると、要素が詰まりすぎて読みにくくなる可能性がある。

#### 対策

- 複数のデバイスでビジュアルテストを実施
- 最小余白の基準を設ける（最低でもp-2 = 8px）
- デザイナーまたはステークホルダーのレビューを受ける
- 必要に応じて微調整を行う

### リスク2: 既存のテストケースに影響

#### リスクレベル: 低

#### 内容

クラス名の変更により、既存のテストケースが失敗する可能性がある。

#### 対策

- テストケースを事前に確認
- クラス名に依存したテストがある場合は修正
- ビジュアルリグレッションテストを追加検討

### リスク3: 他の画面サイズへの影響

#### リスクレベル: 低

#### 内容

タブレット（768px-1024px）サイズでの表示が最適化されていない可能性。

#### 対策

- タブレットサイズでもテストを実施
- 必要に応じて中間ブレークポイント（md:）を追加

### リスク4: アクセシビリティへの影響

#### リスクレベル: 低

#### 内容

余白が少なすぎると、タッチターゲットが小さくなり、タップしにくくなる可能性。

#### 対策

- インタラクティブ要素（ボタン、リンク）の最小サイズを維持（44×44px）
- テーブル行のタップ領域を確保
- 必要に応じて、セル内の余白は維持

---

## 検証方法

### 1. ビジュアル検証

#### 対象デバイス

- **スマートフォン**:
  - iPhone SE (375px × 667px)
  - iPhone 12/13/14 (390px × 844px)
  - iPhone 14 Pro Max (430px × 932px)
  - Android (360px × 640px)
- **タブレット**:
  - iPad Mini (768px × 1024px)
  - iPad Pro (1024px × 1366px)
- **デスクトップ**:
  - 1280px × 720px
  - 1920px × 1080px

#### 確認項目

- [ ] グラフが適切なサイズで表示される
- [ ] 軸ラベルが読みやすい
- [ ] テーブルが横スクロールなしで表示される（または適切にスクロール可能）
- [ ] 要素が詰まりすぎていない
- [ ] カードの影や角丸が適切に表示される
- [ ] ダークモードでも問題ない

### 2. 機能検証

#### 確認項目

- [ ] グラフのツールチップが正しく表示される
- [ ] グラフのアニメーションが正しく動作する
- [ ] テーブルの横スクロールが正しく動作する
- [ ] ダークモード切り替えが正しく動作する
- [ ] 為替レート変更時の再計算が正しく動作する

### 3. パフォーマンス検証

#### 確認項目

- [ ] ページの読み込み速度が劣化していない
- [ ] グラフのレンダリング速度が劣化していない
- [ ] Lighthouse スコアが維持されている（特にCLS）

### 4. アクセシビリティ検証

#### 確認項目

- [ ] キーボードナビゲーションが正しく動作する
- [ ] スクリーンリーダーでの読み上げが正しい
- [ ] タッチターゲットのサイズが十分（44×44px以上）
- [ ] コントラスト比が維持されている

### 5. ブラウザ互換性検証

#### 対象ブラウザ

- Safari (iOS)
- Chrome (Android)
- Chrome (Desktop)
- Firefox (Desktop)
- Safari (macOS)

---

## 参考資料

### デザインガイドライン

- [Material Design - Layout](https://material.io/design/layout/understanding-layout.html)
- [iOS Human Interface Guidelines - Layout](https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/layout/)
- [Tailwind CSS - Responsive Design](https://tailwindcss.com/docs/responsive-design)

### ベストプラクティス

- モバイルファーストデザイン
- 最小タッチターゲットサイズ: 44×44px（iOS）、48×48px（Android）
- コンテンツ優先の設計
- 段階的な余白調整（progressive enhancement）

### 類似の実装例

他の配当金可視化アプリやグラフアプリケーションでの実装例：

1. **Yahoo Finance**: モバイルでは余白を最小限に抑え、グラフを大きく表示
2. **Trading View**: 全画面表示オプションを提供
3. **Google Analytics**: モバイルではカードの余白を縮小

---

## まとめ

### 推奨アプローチ

**段階的余白調整 + グラフ高さ調整** を推奨する。

この組み合わせにより：
- グラフの表示領域を約52%増加（199px → 303px）
- デスクトップの表示を維持
- 実装工数を抑える（約6.5時間）
- リスクを最小化

### 期待される効果

- **ユーザー体験の向上**: グラフが見やすくなり、ピンチ操作の必要性が減少
- **情報密度の向上**: 同じ画面でより多くのデータを表示できる
- **モバイルファーストの実現**: スマートフォンでの利用を最優先したデザイン

### 次のステップ

1. 本仕様書のレビューと承認
2. フェーズ1の実装開始
3. 各デバイスでの検証
4. フィードバックに基づく微調整
5. フェーズ2、3の実装（必要に応じて）

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|---------|--------|
| 2026-02-13 | 1.0 | 初版作成 | GitHub Copilot |
