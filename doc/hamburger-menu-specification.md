# ハンバーガーメニュー導入仕様書

## 概要

本ドキュメントは、divichart-next-js-appアプリケーションにおいて、モバイル画面でのユーザビリティを向上させるため、ヘッダーのナビゲーションメニューをハンバーガーメニューに変更する仕様を検討したものです。

## 作成日

2026年2月9日

---

## 現状分析

### 現在の実装状況

現在、ヘッダーコンポーネント（`src/app/components/Header.tsx`）では、以下の3つのナビゲーションリンクが常に表示されています：

1. **年別配当** - ルート（`/`）
2. **累計配当** - `/cumulative`
3. **ポートフォリオ** - `/portfolio`

#### 現在のヘッダーレイアウト構造

```typescript
<header>
  <div className="flex justify-between items-center h-16">
    {/* 左側: ロゴとナビゲーション */}
    <div className="flex items-center gap-6">
      <h1>divichart</h1>
      <nav className="flex gap-4">
        <Link href="/">年別配当</Link>
        <Link href="/cumulative">累計配当</Link>
        <Link href="/portfolio">ポートフォリオ</Link>
      </nav>
    </div>
    
    {/* 右側: ダークモード切り替えボタン */}
    <div className="flex items-center">
      <button>テーマ切り替え</button>
    </div>
  </div>
</header>
```

### 現状の問題点

#### 1. モバイル画面での表示問題

- **狭苦しいレイアウト**
  - 3つのナビゲーションリンクがヘッダーに並ぶため、スマートフォンなどの小さい画面では窮屈になる
  - テキストが長いため、小画面では折り返しや文字の縮小が発生する可能性がある
  - ダークモード切り替えボタンも含めると、さらにスペースが限られる

- **タップ領域の問題**
  - リンク間の間隔が狭く、タップミスが発生しやすい
  - モバイルでの推奨タップ領域（44x44px以上）を確保しづらい

#### 2. スケーラビリティの問題

- **将来的なメニュー追加の困難さ**
  - 今後新しいページやメニュー項目を追加する際、さらに表示領域が不足する
  - [機能追加検討ドキュメント](./feature-addition-consideration.md)で提案されている機能（設定画面、カレンダービュー、レポート画面など）を追加する場合、現在の水平メニューでは対応が難しい

#### 3. レスポンシブデザインの課題

- **現在の実装**
  - ダークモード切り替えボタンのラベルは`sm:inline`で制御されているが、ナビゲーションリンクには特別なレスポンシブ対応がない
  - すべての画面サイズで同じレイアウトが表示される

---

## ハンバーガーメニュー導入の目的

### 1. ユーザビリティの向上

- **モバイル画面の最適化**
  - スマートフォンやタブレットでの閲覧体験を改善
  - より広い画面領域をメインコンテンツに使用できる

- **操作性の向上**
  - 十分なタップ領域を確保し、誤操作を防止
  - メニュー項目を縦方向に配置することで、選択しやすくする

### 2. デザインの洗練

- **モダンなUIパターンの採用**
  - ハンバーガーメニューは現代的なWebアプリケーションの標準的なUIパターン
  - ユーザーが直感的に理解できるインターフェース

- **すっきりとした見た目**
  - ヘッダーをシンプルに保ち、アプリケーションの視認性を向上

### 3. 拡張性の確保

- **将来的なメニュー追加に対応**
  - 新しいページや機能を追加する際に、容易に対応可能
  - メニュー構造の階層化も可能（セクション分けなど）

---

## 提案する実装方式

### 1. レスポンシブデザインのアプローチ

#### オプションA: モバイルのみハンバーガーメニュー（推奨）

**概要**:
- 画面幅が一定以下（例: 768px未満）の場合のみハンバーガーメニューを表示
- デスクトップでは現在のレイアウト（水平メニュー）を維持

**メリット**:
- デスクトップユーザーの操作性を維持
- クリック数を最小限に抑える（デスクトップでは直接アクセス可能）
- 段階的な改善が可能

**デメリット**:
- 2つの異なるUIパターンを保守する必要がある

**実装の考慮点**:
```typescript
// Tailwind CSSのブレークポイントを使用
<nav className="hidden md:flex gap-4">
  {/* デスクトップ: 水平メニュー */}
</nav>
<button className="md:hidden">
  {/* モバイル: ハンバーガーメニューボタン */}
</button>
```

#### オプションB: すべての画面でハンバーガーメニュー

**概要**:
- 画面サイズに関わらず、常にハンバーガーメニューを使用

**メリット**:
- 一貫したUI/UXを提供
- 実装がシンプル
- ヘッダーが常にすっきりとした見た目

**デメリット**:
- デスクトップでもメニューを開くためのクリックが必要（操作数の増加）
- デスクトップユーザーには不便な可能性

#### 推奨方式

**オプションA（モバイルのみハンバーガーメニュー）を推奨します。**

理由:
- 現在の主要なユースケースはモバイルでの閲覧
- デスクトップユーザーの体験を損なわない
- 業界標準のベストプラクティス
- Tailwind CSSのブレークポイントを活用した実装が容易

---

### 2. メニューの開閉動作

#### メニュー開閉の状態管理

```typescript
const [isMenuOpen, setIsMenuOpen] = useState(false);

// メニューの開閉を切り替える関数
const toggleMenu = () => {
  setIsMenuOpen((prev) => !prev);
};

// メニューリンククリック時に自動的に閉じる
const handleMenuLinkClick = () => {
  setIsMenuOpen(false);
};
```

#### アニメーション

**オプション1: Tailwind CSSのトランジション**
```typescript
// シンプルなフェード&スライド
className={`transition-all duration-300 ease-in-out ${
  isMenuOpen ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-full'
}`}
```

**オプション2: Framer Motionライブラリ（より高度）**
- 滑らかなアニメーション効果
- アクセシビリティに配慮した実装
- 追加のライブラリが必要

**推奨**: オプション1（Tailwind CSSのトランジション）
- 追加ライブラリ不要
- パフォーマンスが良い
- プロジェクトの既存スタイルと一貫性がある

#### メニューを閉じるトリガー

1. **メニュー項目をクリック**
   - ページ遷移時にメニューを自動的に閉じる

2. **オーバーレイをクリック**
   - メニュー外の領域をクリックした際にメニューを閉じる

3. **ESCキー押下**
   - キーボード操作でもメニューを閉じられるようにする

4. **画面サイズ変更**
   - モバイルからデスクトップに切り替わった際、メニューを自動的に閉じる

---

### 3. ハンバーガーメニューの配置とデザイン

#### メニューボタンの配置

**オプションA: 左上（ロゴの左側）**
```
[☰] divichart          [🌙 ダークモード]
```

**オプションB: 右上（ダークモード切り替えボタンの右側）**
```
divichart          [🌙 ダークモード] [☰]
```

**オプションC: ロゴとダークモードボタンの間**
```
divichart [☰]          [🌙 ダークモード]
```

**推奨**: オプションA（左上、ロゴの左側）
- 最も一般的な配置
- ユーザーの視線の流れに沿っている（左から右）
- モバイルアプリの標準的なパターン

#### メニューパネルのデザイン

**スライド方向**:
- **左からスライド** - 推奨（ハンバーガーボタンが左側にあるため自然）
- 右からスライド

**表示サイズ**:
- 画面幅の70-80%程度（残り20-30%はオーバーレイ）
- 最大幅: 320px程度

**スタイリング**:
```typescript
<div className="fixed inset-y-0 left-0 w-80 max-w-[80vw] bg-white dark:bg-gray-800 
                shadow-2xl z-50 transform transition-transform duration-300">
  {/* メニューコンテンツ */}
</div>
```

---

### 4. メニュー項目の構成

#### 基本構成（現在のメニュー項目）

```typescript
<nav className="flex flex-col">
  <Link href="/" className="py-4 px-6 hover:bg-gray-100 dark:hover:bg-gray-700">
    📊 年別配当
  </Link>
  <Link href="/cumulative" className="py-4 px-6 hover:bg-gray-100 dark:hover:bg-gray-700">
    📈 累計配当
  </Link>
  <Link href="/portfolio" className="py-4 px-6 hover:bg-gray-100 dark:hover:bg-gray-700">
    💼 ポートフォリオ
  </Link>
</nav>
```

#### 拡張案（将来的な追加項目）

```typescript
<nav className="flex flex-col">
  {/* 主要機能 */}
  <div className="px-4 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">
    データ表示
  </div>
  <Link href="/">📊 年別配当</Link>
  <Link href="/cumulative">📈 累計配当</Link>
  <Link href="/portfolio">💼 ポートフォリオ</Link>
  
  {/* セパレーター */}
  <div className="border-t border-gray-200 dark:border-gray-700 my-2"></div>
  
  {/* 設定・その他 */}
  <div className="px-4 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">
    設定
  </div>
  <Link href="/settings">⚙️ 設定</Link>
</nav>
```

#### アクセシビリティの考慮

- **アイコンの使用**: 視覚的な手がかりを提供（オプション）
- **ARIAラベル**: スクリーンリーダー対応
- **フォーカス管理**: メニュー開閉時の適切なフォーカス移動
- **キーボード操作**: Tab、Enter、ESCキーでの操作を可能にする

---

### 5. オーバーレイ（背景）の実装

#### オーバーレイの役割

1. メニューが開いている間、背後のコンテンツをブロック
2. メニュー外をクリックした際に、メニューを閉じるトリガー
3. メニューが開いていることを視覚的に強調

#### 実装例

```typescript
{isMenuOpen && (
  <div 
    className="fixed inset-0 bg-black/50 z-40"
    onClick={closeMenu}
    aria-hidden="true"
  />
)}
```

#### スタイリング詳細

- **背景色**: 黒色（`bg-black`）
- **透明度**: 50%（`/50`）
- **z-index**: メニューパネルより低く、他のコンテンツより高く（`z-40`）
- **クリックイベント**: オーバーレイクリックでメニューを閉じる

---

## コンポーネント構造

### 提案する新しいHeader.tsxの構造

```
Header
├── ヘッダーコンテナ
│   ├── 左側セクション
│   │   ├── ハンバーガーメニューボタン（md:hidden - モバイルのみ）
│   │   ├── ロゴ（divichart）
│   │   └── 水平ナビゲーション（hidden md:flex - デスクトップのみ）
│   └── 右側セクション
│       └── ダークモード切り替えボタン
├── オーバーレイ（メニューが開いている時のみ）
└── スライドメニューパネル（モバイル用）
    ├── メニューヘッダー（ロゴ + 閉じるボタン）
    └── ナビゲーションリンクリスト
```

### 必要な状態管理

```typescript
// メニューの開閉状態
const [isMenuOpen, setIsMenuOpen] = useState(false);

// メニューを開閉する関数
const toggleMenu = () => setIsMenuOpen(!isMenuOpen);

// メニューを閉じる関数
const closeMenu = () => setIsMenuOpen(false);
```

---

## 実装の詳細仕様

### 1. ハンバーガーメニューアイコン

#### オプションA: SVGアイコン（推奨）

```typescript
<button onClick={toggleMenu} aria-label="メニューを開く">
  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
          d="M4 6h16M4 12h16M4 18h16" />
  </svg>
</button>
```

**メリット**:
- カスタマイズ可能（色、サイズなど）
- ダークモードに自動対応（`currentColor`を使用）
- 追加のアセット不要

#### オプションB: アニメーション付きアイコン

メニューの開閉状態に応じてアイコンが変化（3本線 ⇔ ×マーク）

```typescript
<button onClick={toggleMenu}>
  {isMenuOpen ? (
    <svg>{ /* ×マークのパス */ }</svg>
  ) : (
    <svg>{ /* 3本線のパス */ }</svg>
  )}
</button>
```

**推奨**: オプションA（シンプルなSVGアイコン）
- 実装がシンプル
- メニューパネル内に明確な「閉じる」ボタンを配置するため、ハンバーガーアイコン自体の変化は不要

---

### 2. メニューパネルの実装詳細

#### z-indexの階層構造

```
z-50: メニューパネル（最前面）
z-40: オーバーレイ（背景）
z-30: （未使用）
z-20: （未使用）
z-10: （未使用）
z-0:  通常コンテンツ
```

ヘッダーの`z-50`と統一するため、メニューパネルも`z-50`を使用

#### スクロール動作

**メニュー内のスクロール**:
```typescript
<div className="overflow-y-auto h-full">
  {/* メニューコンテンツ */}
</div>
```

**背後のコンテンツのスクロール防止**:
```typescript
useEffect(() => {
  const previousOverflow = document.body.style.overflow;

  if (isMenuOpen) {
    document.body.style.overflow = 'hidden';
  } else {
    // メニューを閉じる際は、変更前の値を復元する
    document.body.style.overflow = previousOverflow || '';
  }

  return () => {
    // クリーンアップ時にも変更前の値を復元する
    document.body.style.overflow = previousOverflow || '';
  };
}, [isMenuOpen]);
```

---

### 3. アクセシビリティの実装

#### ARIAラベルとロール

```typescript
{/* ハンバーガーメニューボタン */}
<button
  onClick={toggleMenu}
  aria-label="メニューを開く"
  aria-expanded={isMenuOpen}
  aria-controls="mobile-menu"
  className="md:hidden"
>
  {/* アイコン */}
</button>

{/* メニューパネル */}
<nav
  id="mobile-menu"
  role="navigation"
  aria-label="メインメニュー"
  className={/* ... */}
>
  {/* メニュー項目 */}
</nav>

{/* オーバーレイ */}
<div
  onClick={closeMenu}
  aria-hidden="true"
  className="fixed inset-0 bg-black/50"
/>
```

#### キーボード操作の実装

```typescript
useEffect(() => {
  const handleEscape = (e: KeyboardEvent) => {
    if (e.key === 'Escape' && isMenuOpen) {
      closeMenu();
    }
  };
  
  document.addEventListener('keydown', handleEscape);
  return () => document.removeEventListener('keydown', handleEscape);
}, [isMenuOpen]);
```

#### フォーカストラップ

メニューが開いている間、フォーカスをメニュー内に閉じ込める（react-focus-lockライブラリの使用を検討）

---

### 4. スタイリングの詳細

#### ダークモード対応

現在のプロジェクトと同様に、すべての要素にダークモードのスタイルを提供：

```typescript
// メニューパネル
className="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"

// メニュー項目
className="hover:bg-gray-100 dark:hover:bg-gray-700"

// セパレーター
className="border-gray-200 dark:border-gray-700"
```

#### トランジション

```typescript
// メニューパネル
className="transform transition-transform duration-300 ease-in-out"

// オーバーレイ
className="transition-opacity duration-300"
```

---

## テストケース

### 機能テスト

1. **メニューの開閉**
   - [ ] ハンバーガーボタンをクリックしてメニューが開く
   - [ ] 閉じるボタンでメニューが閉じる
   - [ ] オーバーレイをクリックしてメニューが閉じる
   - [ ] ESCキーでメニューが閉じる

2. **ナビゲーション**
   - [ ] 各メニュー項目をクリックして正しいページに遷移する
   - [ ] ページ遷移後にメニューが自動的に閉じる

3. **レスポンシブデザイン**
   - [ ] モバイル画面（768px未満）でハンバーガーメニューが表示される
   - [ ] デスクトップ画面（768px以上）で水平メニューが表示される
   - [ ] 画面サイズを変更した際に適切に切り替わる

4. **アニメーション**
   - [ ] メニューが滑らかにスライドして表示される
   - [ ] オーバーレイがフェードインする

5. **ダークモード**
   - [ ] ダークモードでメニューが適切に表示される
   - [ ] メニュー内でダークモードを切り替えられる

### アクセシビリティテスト

1. **キーボード操作**
   - [ ] Tabキーでメニュー項目間を移動できる
   - [ ] Enterキーでリンクをアクティブ化できる
   - [ ] ESCキーでメニューを閉じられる

2. **スクリーンリーダー**
   - [ ] ARIAラベルが適切に読み上げられる
   - [ ] メニューの開閉状態が通知される

3. **フォーカス管理**
   - [ ] メニューを開いた際、最初の項目にフォーカスが移動する
   - [ ] メニューを閉じた際、ハンバーガーボタンにフォーカスが戻る

### パフォーマンステスト

1. **アニメーション**
   - [ ] アニメーションが60FPSで滑らかに動作する
   - [ ] ローエンドデバイスでもパフォーマンスが良好

2. **メモリ使用量**
   - [ ] メニューの開閉を繰り返してもメモリリークが発生しない

---

## 実装の段階的アプローチ

### フェーズ1: 基本実装（推奨開始点）

**目標**: 最小限の機能でハンバーガーメニューを動作させる

1. **ハンバーガーボタンの追加**
   - モバイル画面でのみ表示
   - シンプルなSVGアイコン

2. **基本的なメニューパネル**
   - 左からスライドして表示
   - 3つの既存ナビゲーションリンクを含む
   - 閉じるボタン

3. **オーバーレイの実装**
   - 背景をクリックしてメニューを閉じる

4. **レスポンシブ切り替え**
   - デスクトップでは従来の水平メニューを表示

**想定工数**: 4-6時間

---

### フェーズ2: アニメーションと洗練（推奨次ステップ）

**目標**: ユーザー体験を向上させる

1. **トランジション効果**
   - スライドアニメーション
   - フェードイン/フェードアウト

2. **スタイリングの改善**
   - ホバー効果
   - アクティブなページのハイライト

3. **ESCキーでの閉じる機能**

**想定工数**: 2-3時間

---

### フェーズ3: アクセシビリティ対応（重要）

**目標**: すべてのユーザーが利用できるようにする

1. **ARIAラベルの追加**
   - 適切なロールとプロパティ

2. **キーボードナビゲーション**
   - Tabキーでのフォーカス移動
   - Enterキーでのアクティベーション

3. **フォーカス管理**
   - メニュー開閉時の適切なフォーカス移動

**想定工数**: 2-3時間

---

### フェーズ4: 拡張機能（将来的）

**目標**: より高度な機能を追加

1. **セクション分け**
   - メニュー項目をカテゴリ別にグループ化

2. **設定画面へのリンク追加**
   - 為替レート設定などの専用ページ

3. **メニュー内検索機能**（オプション）

**想定工数**: 3-5時間

---

## 技術的考慮事項

### 1. 既存コードへの影響

**影響を受けるファイル**:
- `src/app/components/Header.tsx` - メインの変更箇所
- `src/app/components/DarkModeProvider.tsx` - 影響なし（変更不要）

**影響を受けないファイル**:
- ページコンポーネント（`page.tsx`, `cumulative/page.tsx`, `portfolio/page.tsx`）
- データ処理ロジック
- スタイリング設定

### 2. 依存関係

**追加ライブラリの必要性**:
- **不要** - Tailwind CSSとReactの標準機能のみで実装可能

**オプションで検討できるライブラリ**:
- `framer-motion` - より高度なアニメーション（オーバーキルの可能性あり）
- `react-focus-lock` - フォーカストラップ（アクセシビリティ向上）

### 3. パフォーマンスへの影響

**懸念事項**:
- メニューの開閉時のリレンダリング
- アニメーション処理

**最適化戦略**:
- `useState`での状態管理（軽量）
- CSS transformを使用したアニメーション（GPUアクセラレーション）
- 不要なリレンダリングの防止（`React.memo`、`useCallback`の活用）

### 4. ブラウザ互換性

**対象ブラウザ**:
- Chrome、Firefox、Safari、Edge（最新2バージョン）
- iOS Safari、Chrome Mobile

**確認が必要な機能**:
- CSS transform
- position: fixed
- backdrop-filter（オプション）

---

## セキュリティ考慮事項

### XSS対策

- Next.js の Link コンポーネントと固定の内部パスのみを使用（ユーザー入力を介さないため XSS リスクは低い）
- 現状は外部リンクやユーザー入力由来の URL は含まない想定（将来的に外部リンクを追加する場合は `rel="noopener noreferrer"` を付与し、ユーザー入力を含む URL は別途バリデーション・正規化を行う）

### アクセス制御

- 現時点では認証機能がないため、すべてのメニュー項目は誰でもアクセス可能
- 将来的に認証機能を追加する場合、メニュー項目の表示/非表示を制御

---

## 代替案の検討

### 代替案1: ドロップダウンメニュー

**概要**: ハンバーガーメニューの代わりに、ヘッダー内でドロップダウンメニューを使用

**メリット**:
- メニューを開くためのオーバーレイが不要
- 実装がやや簡単

**デメリット**:
- メニュー項目が多い場合、スクロールが必要
- タップ領域が小さくなる可能性

**結論**: ハンバーガーメニューの方がモバイルでのユーザビリティが高いため、不採用

---

### 代替案2: ボトムナビゲーション

**概要**: 画面下部に固定されたナビゲーションバー（モバイルアプリでよく使われるパターン）

**メリット**:
- 親指で操作しやすい
- 常に表示されているため、アクセスが容易

**デメリット**:
- コンテンツ表示領域が減少
- デスクトップでは一般的ではない
- 将来的にメニュー項目が増えた場合、対応が難しい

**結論**: ボトムナビゲーションは別の機会に検討する可能性はあるが、今回は不採用

---

### 代替案3: タブナビゲーション

**概要**: ページ内でタブを使用してビューを切り替える（SPA的なアプローチ）

**メリット**:
- ページ遷移が不要
- 滑らかなユーザー体験

**デメリット**:
- アプリケーションの構造を大きく変更する必要がある
- URLベースのルーティングが失われる
- ブックマーク、共有が困難

**結論**: アプリケーションの根本的な設計変更が必要なため、不採用

---

## まとめ

### 推奨される実装方針

1. **レスポンシブアプローチ**: モバイル（768px未満）のみハンバーガーメニュー、デスクトップは従来の水平メニュー
2. **メニュー配置**: 左上（ロゴの左側）にハンバーガーボタン
3. **スライド方向**: 左からスライド
4. **アニメーション**: Tailwind CSSのトランジション
5. **アクセシビリティ**: ARIAラベル、キーボード操作、フォーカス管理を実装

### 期待される効果

1. **ユーザビリティの向上**
   - モバイル画面での操作性が改善される
   - 十分なタップ領域が確保される

2. **スケーラビリティ**
   - 将来的なメニュー項目の追加が容易になる
   - セクション分けや階層化が可能

3. **デザインの洗練**
   - モダンで直感的なUIを提供
   - ヘッダーがすっきりとした見た目になる

4. **保守性**
   - 既存コードへの影響を最小限に抑える
   - 明確な実装パターンで保守が容易

### 次のステップ

1. **本仕様書のレビュー**
   - チーム内でフィードバックを収集
   - 必要に応じて仕様を調整

2. **プロトタイプ作成**（オプション）
   - Figmaなどでモックアップを作成
   - ユーザビリティテスト

3. **実装計画の策定**
   - 実装の優先順位を決定
   - タスクの分割とスケジューリング

4. **実装開始**
   - フェーズ1から段階的に実装
   - 各フェーズでレビューとテストを実施

---

## 参考資料

### 関連ドキュメント

- [機能追加検討ドキュメント](./feature-addition-consideration.md) - 将来的な機能追加の計画
- [開発者仕様書](./developer-specification.md) - プロジェクト全体の技術仕様
- [GitHub Copilot Instructions](../.github/copilot-instructions.md) - 開発ガイドライン

### 外部リソース

- [Tailwind CSS - Responsive Design](https://tailwindcss.com/docs/responsive-design)
- [React - Handling Events](https://react.dev/learn/responding-to-events)
- [WAI-ARIA - Menu Button Pattern](https://www.w3.org/WAI/ARIA/apg/patterns/menubutton/)
- [Web Content Accessibility Guidelines (WCAG)](https://www.w3.org/WAI/WCAG21/quickref/)

### 類似実装の例

- [Next.js公式サイト](https://nextjs.org/) - レスポンシブナビゲーションの参考
- [Tailwind UI Components](https://tailwindui.com/components/application-ui/navigation/navbars) - 実装パターン

---

## 変更履歴

- 2026年2月9日: 初版作成
