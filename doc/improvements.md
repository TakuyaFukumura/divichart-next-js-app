# 改善点リスト

このドキュメントは、リポジトリの調査結果をまとめ、今後の改善提案をリストアップしたものです。

## 調査日時

最終更新: 2026年2月7日
前回更新: 2026年2月5日

## 改善カテゴリ

- [コード品質](#コード品質)
- [テスト](#テスト)
- [セキュリティ](#セキュリティ)
- [パフォーマンス](#パフォーマンス)
- [ユーザビリティ](#ユーザビリティ)
- [保守性](#保守性)
- [ドキュメント](#ドキュメント)

---

## 完了済みの改善項目

### ✅ 1. 不要なESLint無効化ディレクティブの削除（完了）

**対応日**: 2026年2月7日

**対応内容**:
- ESLint無効化コメントが削除され、コードが適切に修正された
- 現在、ESLint実行時にエラーや警告は表示されない

---

### ✅ 2. コンポーネントの分割（完了）

**対応日**: 2026年2月7日

**対応内容**:
- メインページ（page.tsx）から以下のコンポーネントを分割:
  - `DividendTable.tsx`: テーブル表示コンポーネント
  - `DividendPieChart.tsx`: 円グラフ表示コンポーネント
  - `YearSelector.tsx`: 年選択コンポーネント
- カスタムフックの作成:
  - `useDividendData`: データ読み込み用カスタムフック
- ビジネスロジックの分離:
  - `lib/dividendCalculator.ts`: 配当金計算ロジック
  - `lib/csvLoader.ts`: CSV読み込みロジック
- 型定義の整理:
  - `types/dividend.ts`: 配当金関連の型定義

**成果**:
- page.tsxが293行から258行に削減
- 可読性とテストしやすさが向上
- 再利用性の向上

---

### ✅ 3. メインページのテストカバレッジ追加（完了）

**対応日**: 2026年2月7日

**対応内容**:
- `__tests__/src/app/page.test.tsx`: メインページのテスト追加
- `__tests__/src/lib/dividendCalculator.test.ts`: ビジネスロジックのテスト追加
- `__tests__/src/app/components/`: 各コンポーネントのテスト追加
- `__tests__/src/app/cumulative/page.test.tsx`: 累計ページのテスト追加

**カバレッジ項目**:
- CSVデータの正常な読み込み
- CSVパースエラー時の動作
- 年別配当金の集計ロジック
- チャート表示
- ローディング状態の表示

---

### ✅ 4. 型定義の強化（完了）

**対応日**: 2026年2月7日

**対応内容**:
- `src/types/dividend.ts`を作成し、型定義を集約
- CSVRow、StockDividend、YearlyPortfolio等の型を定義
- JSDocコメントによる詳細なドキュメント化

---

### ✅ 5. API/インターフェースドキュメントの追加（完了）

**対応日**: 2026年2月7日

**対応内容**:
- 主要なコンポーネント、関数にJSDocコメントを追加
- 関数のパラメータと戻り値の型情報を詳細に記載
- ビジネスロジックの動作を説明するコメントを追加

---

### ✅ 6. アーキテクチャドキュメントの追加（完了）

**対応日**: 2026年2月7日

**対応内容**:
- `doc/developer-specification.md`を作成
- システム全体のアーキテクチャを詳細に記載
- データフロー、コンポーネント構成、技術選定の理由を文書化

---

### ✅ 7. 機能拡張: 複数ページの追加（完了）

**対応日**: 2026年2月7日

**対応内容**:
- `/cumulative`ページ: 累計配当金の折れ線グラフ表示
- `/portfolio`ページ: 銘柄別配当金の円グラフ表示
- ナビゲーション機能の追加

---

## コード品質

## コード品質

### 1. CSVファイルパスのハードコーディング

**ファイル**: `src/hooks/useDividendData.ts` (16行目)

**現状**:

```typescript
export function useDividendData(csvFilePath: string = '/data/dividendlist_20260205.csv')
```

**問題点**:

- CSVファイル名が日付を含んでハードコーディングされている
- 新しいデータファイルを追加する際に、コードの変更が必要になる

**推奨される対応**:

1. 環境変数でファイルパスを設定可能にする
   ```typescript
   const DEFAULT_CSV_PATH = process.env.NEXT_PUBLIC_CSV_FILE_PATH || '/data/dividendlist_20260205.csv';
   export function useDividendData(csvFilePath: string = DEFAULT_CSV_PATH)
   ```
2. または、最新のCSVファイルを自動的に取得するエンドポイントを作成する
3. または、ファイル選択機能を追加してユーザーが選択できるようにする

**優先度**: 中

**想定工数**: 1-2時間

---

### 2. マジックナンバーの定数化

**ファイル**: `src/app/page.tsx` (19-24行目)

**現状**:

```typescript
const DEFAULT_USD_TO_JPY_RATE = 150;
```

**問題点**:

- デフォルト為替レートが150円とハードコーディングされている
- 実際の為替レートと乖離する可能性が高い

**推奨される対応**:

1. より現実的なデフォルト値を設定する（例：140円）
2. または、外部APIから最新の為替レートを取得する機能を追加する
3. README等のドキュメントにデフォルト値の根拠を記載する

**優先度**: 低

**想定工数**: 30分（為替API連携の場合は4-6時間）

---

### 3. エラーハンドリングの改善

**ファイル**: `src/app/page.tsx`, `src/hooks/useDividendData.ts`

**現状**:

- CSVの読み込みエラーは表示されるが、エラーの種類によって異なる対応ができていない

**問題点**:

- ネットワークエラー、ファイルが存在しないエラー、パースエラーなど、異なるエラーに対して同じメッセージが表示される
- ユーザーがエラーの原因を特定しづらい

**推奨される対応**:

1. エラーの種類に応じた詳細なエラーメッセージを表示する
2. リトライボタンを追加する
3. エラーをログに記録する仕組みを追加する

**優先度**: 中

**想定工数**: 2-3時間

---

## テスト

### 4. E2Eテストの不在

**現状**:

- ユニットテストのみでE2Eテストが存在しない

**問題点**:

- 実際のブラウザでの動作確認が自動化されていない
- ユーザーフローの検証ができていない

**推奨される対応**:

1. Playwrightを導入してE2Eテストを追加する
2. 主要なユーザーフローをテストする:
    - ページの読み込み
    - ダークモードの切り替え
    - チャート種類の切り替え
    - 為替レート変更

**優先度**: 中

**想定工数**: 6-8時間

---

## セキュリティ

### 5. Content Security Policy (CSP) の未設定

**現状**:

- CSPヘッダーが設定されていない

**問題点**:

- XSS攻撃のリスクが高まる
- インラインスクリプトの実行を制限できない

**推奨される対応**:

1. `next.config.ts`でセキュリティヘッダーを設定する
2. CSPを段階的に導入する

**優先度**: 中

**想定工数**: 2-3時間

---

### 6. 依存関係の脆弱性チェックの強化

**現状**:

- Dependabotは設定されているが、npm auditの結果がCIで確認されていない

**問題点**:

- 新しい脆弱性が発見された際の対応が遅れる可能性がある

**推奨される対応**:

1. CIワークフローにnpm audit checkを追加する
2. 脆弱性が発見された場合はビルドを失敗させる

**優先度**: 中

**想定工数**: 1時間

---

## パフォーマンス

### 7. CSVデータのキャッシング

**ファイル**: `src/hooks/useDividendData.ts`

**現状**:

- 毎回ページを開くたびにCSVファイルを読み込んでいる

**問題点**:

- 不要なネットワークリクエストが発生する
- 初回ロード時間が長い

**推奨される対応**:

1. Service WorkerやHTTPキャッシュヘッダーを活用する
2. データが更新されていない場合は再取得しない仕組みを追加する

**優先度**: 低

**想定工数**: 2-3時間

---

### 8. チャートコンポーネントの最適化

**ファイル**: `src/app/page.tsx`

**現状**:

- チャート切り替え時に完全に再レンダリングされる

**問題点**:

- アニメーションがスムーズでない可能性がある
- 不要な再計算が発生している

**推奨される対応**:

1. `useMemo`や`useCallback`を使用して不要な再計算を防ぐ
2. Rechartsのアニメーション設定を最適化する

**優先度**: 低

**想定工数**: 2-3時間

---

## ユーザビリティ

### 9. 為替レート入力のバリデーション改善

**ファイル**: `src/app/page.tsx` (199-222行目)

**現状**:

- 無効な値を入力しても視覚的なフィードバックが少ない

**問題点**:

- ユーザーが無効な値を入力した際のフィードバックが不明瞭
- 最小値・最大値の制限がない

**推奨される対応**:

1. 入力値の範囲に制限を設ける（例：50円～300円）
2. 無効な値の場合、視覚的にエラーを表示する
3. デバウンス処理を追加して入力中の頻繁な再計算を防ぐ

**優先度**: 中

**想定工数**: 2-3時間

---

### 10. ローディング状態の改善

**ファイル**: `src/app/page.tsx` (122-131行目)

**現状**:

- シンプルなスピナーのみ表示される

**問題点**:

- 何を読み込んでいるかがわかりにくい
- プログレス情報がない

**推奨される対応**:

1. 読み込み中の具体的な処理を表示する
2. スケルトンスクリーンを使用してレイアウトシフトを防ぐ

**優先度**: 低

**想定工数**: 2-3時間

---

### 11. データがない場合の表示改善

**現状**:

- データが0件の場合の表示が考慮されていない

**問題点**:

- 空のグラフとテーブルが表示される
- ユーザーが混乱する可能性がある

**推奨される対応**:

1. データがない場合の専用メッセージを表示する
2. サンプルデータへのリンクやデータの追加方法を案内する

**優先度**: 中

**想定工数**: 1-2時間

---

### 12. レスポンシブデザインの改善

**ファイル**: `src/app/page.tsx`

**現状**:

- モバイルでの表示は考慮されているが、タブレットサイズの最適化が不足

**問題点**:

- 中間サイズの画面での表示が最適化されていない
- テーブルが横スクロールになる場合の案内が不足

**推奨される対応**:

1. タブレットサイズ用のレイアウトを追加する
2. 横スクロール可能な要素には視覚的なヒントを表示する

**優先度**: 低

**想定工数**: 2-3時間

---

## 保守性

### 13. 設定ファイルの集約

**現状**:

- アプリケーション設定が複数のファイルに分散している

**問題点**:

- デフォルト為替レート、CSVファイルパスなどの設定が分散している
- 環境ごとの設定管理が困難

**推奨される対応**:

1. `src/config/`ディレクトリを作成し、設定を集約する
2. 環境変数の管理を`.env.example`で明示する

**優先度**: 中

**想定工数**: 2-3時間

---

### 14. 型定義のさらなる強化

**ファイル**: `src/types/dividend.ts`

**現状**:

- 基本的な型定義は存在し、よく整理されている

**問題点**:

- 為替レートの型がnumberのみで、範囲制約がない
- より厳密なバリデーションが可能

**推奨される対応**:

1. branded typeを使用して為替レートの型安全性を向上させる
2. Zodなどのスキーマバリデーションライブラリを導入する
3. ランタイムでのデータ検証を強化する

**優先度**: 低

**想定工数**: 3-4時間

---

## ドキュメント

### 15. コントリビューションガイドの不足

**現状**:

- `CONTRIBUTING.md`が存在しない

**問題点**:

- 外部貢献者がどのように貢献すればよいか分からない
- コーディング規約やPRの作成方法が明示されていない

**推奨される対応**:

1. `CONTRIBUTING.md`を作成し、以下を記載する:
    - 開発環境のセットアップ方法
    - コーディング規約
    - コミットメッセージの規約
    - PRの作成方法
    - イシューの報告方法

**優先度**: 低

**想定工数**: 2-3時間

---

### 16. CHANGELOGの不足

**現状**:

- `CHANGELOG.md`が存在しない

**問題点**:

- バージョン間の変更内容が追跡できない
- ユーザーが新機能や修正内容を把握しづらい

**推奨される対応**:

1. `CHANGELOG.md`を作成する
2. [Keep a Changelog](https://keepachangelog.com/)形式を採用する
3. リリース時に自動更新する仕組みを追加する

**優先度**: 低

**想定工数**: 1-2時間

---

### 17. Storybookの導入

**現状**:

- コンポーネントカタログやビジュアルテストツールが存在しない

**問題点**:

- コンポーネントの単体での動作確認が困難
- デザインシステムの管理が難しい

**推奨される対応**:

1. Storybookを導入してコンポーネントカタログを作成する
2. 各コンポーネントのストーリーを作成する
3. ビジュアルリグレッションテストを追加する

**優先度**: 低

**想定工数**: 6-8時間

---

## その他の改善提案

### 18. TypeScript設定の最適化

**ファイル**: `tsconfig.json`

**現状**:

- 基本的な設定は適切だが、より厳格にできる

**推奨される対応**:

1. 以下のオプションを有効化する:
    - `noUncheckedIndexedAccess`: 配列アクセスの安全性向上
    - `noPropertyAccessFromIndexSignature`: オブジェクトアクセスの安全性向上
    - `exactOptionalPropertyTypes`: オプショナルプロパティの厳密化

**優先度**: 低

**想定工数**: 1-2時間

---

### 19. CI/CDパイプラインの強化

**ファイル**: `.github/workflows/ci.yml`

**現状**:

- 基本的なCI設定は存在するが、拡張可能

**推奨される対応**:

1. ビルド成果物をキャッシュする
2. テストカバレッジレポートを自動生成・コメントする
3. PRにサイズ変化を自動コメントする
4. Lighthouse CIを追加してパフォーマンスを監視する

**優先度**: 中

**想定工数**: 4-6時間

---

### 20. アクセシビリティの向上

**現状**:

- 基本的なアクセシビリティは考慮されているが、さらに改善可能

**推奨される対応**:

1. 全てのインタラクティブ要素にaria-labelを追加する
2. キーボードナビゲーションを改善する
3. スクリーンリーダーでの使用を検証する
4. eslint-plugin-jsx-a11yを追加する

**優先度**: 中

**想定工数**: 3-4時間

---

### 21. 国際化（i18n）対応の準備

**現状**:

- 全て日本語で実装されている

**推奨される対応**:

1. next-intlまたはnext-i18nextを導入する
2. 文字列を外部ファイルに分離する
3. 英語版を追加する

**優先度**: 低

**想定工数**: 8-12時間

---

## 優先度別まとめ

### 高優先度（すぐに対応すべき）

現在、高優先度の項目は全て完了しています。

### 中優先度（近いうちに対応すべき）

- [1. CSVファイルパスのハードコーディング](#1-csvファイルパスのハードコーディング)
- [3. エラーハンドリングの改善](#3-エラーハンドリングの改善)
- [4. E2Eテストの不在](#4-e2eテストの不在)
- [5. Content Security Policyの未設定](#5-content-security-policy-csp-の未設定)
- [6. 依存関係の脆弱性チェックの強化](#6-依存関係の脆弱性チェックの強化)
- [9. 為替レート入力のバリデーション改善](#9-為替レート入力のバリデーション改善)
- [11. データがない場合の表示改善](#11-データがない場合の表示改善)
- [13. 設定ファイルの集約](#13-設定ファイルの集約)
- [19. CI/CDパイプラインの強化](#19-cicdパイプラインの強化)
- [20. アクセシビリティの向上](#20-アクセシビリティの向上)

### 低優先度（余裕があれば対応）

- [2. マジックナンバーの定数化](#2-マジックナンバーの定数化)
- [7. CSVデータのキャッシング](#7-csvデータのキャッシング)
- [8. チャートコンポーネントの最適化](#8-チャートコンポーネントの最適化)
- [10. ローディング状態の改善](#10-ローディング状態の改善)
- [12. レスポンシブデザインの改善](#12-レスポンシブデザインの改善)
- [14. 型定義のさらなる強化](#14-型定義のさらなる強化)
- [15. コントリビューションガイドの不足](#15-コントリビューションガイドの不足)
- [16. CHANGELOGの不足](#16-changelogの不足)
- [17. Storybookの導入](#17-storybookの導入)
- [18. TypeScript設定の最適化](#18-typescript設定の最適化)
- [21. 国際化（i18n）対応の準備](#21-国際化i18n対応の準備)

---

## 次のステップ

1. 各改善項目についてissueを作成する
2. 優先度に基づいて実装順序を決定する
3. 各issueに対応するPRを作成して段階的に改善を進める
4. 定期的にこのドキュメントを更新し、進捗を追跡する

---

## 備考

- このドキュメントは2026年2月7日時点での調査結果に基づいています
- 2026年2月7日の大規模リファクタリングにより、多くの重要な改善が完了しました
- 実装の際は、各項目の優先度と工数を考慮して計画を立ててください
- 新しい改善点が見つかった場合は、このドキュメントに追加してください

---

## 変更履歴

### 2026年2月7日
- 大規模リファクタリングによる完了項目を追加
  - コンポーネント分割
  - カスタムフックの追加
  - ビジネスロジックの分離
  - テストカバレッジの追加
  - JSDocコメントの追加
  - アーキテクチャドキュメントの追加
- 項目番号を振り直し、完了した項目を整理
- 優先度別まとめを更新

### 2026年2月5日
- 初版作成
- 25項目の改善提案をリストアップ

