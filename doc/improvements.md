# 改善点リスト

このドキュメントは、リポジトリの調査結果をまとめ、今後の改善提案をリストアップしたものです。

## 更新日時

最終更新: 2026年2月7日
前回更新: 2026年2月5日

## 改善カテゴリ

- [コード品質](#コード品質)
- [テスト](#テスト)
- [セキュリティ](#セキュリティ)
- [パフォーマンス](#パフォーマンス)
- [ユーザビリティ](#ユーザビリティ)
- [保守性](#保守性)
- [ドキュメント](#ドキュメント)

---

## コード品質

### 1. CSVファイルパスのハードコーディング

**ファイル**: `src/hooks/useDividendData.ts` (16行目)

**現状**:

```typescript
export function useDividendData(csvFilePath: string = '/data/dividendlist_20260205.csv')
```

**問題点**:

- CSVファイル名が日付を含んでハードコーディングされている
- 新しいデータファイルを追加する際に、コードの変更が必要になる

**推奨される対応**:

1. 環境変数でファイルパスを設定可能にする
   ```typescript
   const DEFAULT_CSV_PATH = process.env.NEXT_PUBLIC_CSV_FILE_PATH || '/data/dividendlist_20260205.csv';
   export function useDividendData(csvFilePath: string = DEFAULT_CSV_PATH)
   ```
2. または、最新のCSVファイルを自動的に取得するエンドポイントを作成する
3. または、ファイル選択機能を追加してユーザーが選択できるようにする

**優先度**: 中

**想定工数**: 1-2時間

---

### 2. エラーハンドリングの改善

**ファイル**: `src/app/page.tsx`, `src/hooks/useDividendData.ts`

**現状**:

- CSVの読み込みエラーは表示されるが、エラーの種類によって異なる対応ができていない

**問題点**:

- ネットワークエラー、ファイルが存在しないエラー、パースエラーなど、異なるエラーに対して同じメッセージが表示される
- ユーザーがエラーの原因を特定しづらい

**推奨される対応**:

1. エラーの種類に応じた詳細なエラーメッセージを表示する
2. リトライボタンを追加する
3. エラーをログに記録する仕組みを追加する

**優先度**: 中

**想定工数**: 2-3時間

---

## テスト

### 4. E2Eテストの不在

**現状**:

- ユニットテストのみでE2Eテストが存在しない

**問題点**:

- 実際のブラウザでの動作確認が自動化されていない
- ユーザーフローの検証ができていない

**推奨される対応**:

1. Playwrightを導入してE2Eテストを追加する
2. 主要なユーザーフローをテストする:
    - ページの読み込み
    - ダークモードの切り替え
    - チャート種類の切り替え
    - 為替レート変更

**優先度**: 中

**想定工数**: 6-8時間

---

## セキュリティ

### 5. Content Security Policy (CSP) の未設定

**現状**:

- CSPヘッダーが設定されていない

**問題点**:

- XSS攻撃のリスクが高まる
- インラインスクリプトの実行を制限できない

**推奨される対応**:

1. `next.config.ts`でセキュリティヘッダーを設定する
2. CSPを段階的に導入する

**優先度**: 中

**想定工数**: 2-3時間

---

### 6. 依存関係の脆弱性チェックの強化

**現状**:

- Dependabotは設定されているが、npm auditの結果がCIで確認されていない

**問題点**:

- 新しい脆弱性が発見された際の対応が遅れる可能性がある

**推奨される対応**:

1. CIワークフローにnpm audit checkを追加する
2. 脆弱性が発見された場合はビルドを失敗させる

**優先度**: 中

**想定工数**: 1時間

---

## パフォーマンス

### 7. CSVデータのキャッシング

**ファイル**: `src/hooks/useDividendData.ts`

**現状**:

- 毎回ページを開くたびにCSVファイルを読み込んでいる

**問題点**:

- 不要なネットワークリクエストが発生する
- 初回ロード時間が長い

**推奨される対応**:

1. Service WorkerやHTTPキャッシュヘッダーを活用する
2. データが更新されていない場合は再取得しない仕組みを追加する

**優先度**: 低

**想定工数**: 2-3時間

---

### 8. チャートコンポーネントの最適化

**ファイル**: `src/app/page.tsx`

**現状**:

- チャート切り替え時に完全に再レンダリングされる

**問題点**:

- アニメーションがスムーズでない可能性がある
- 不要な再計算が発生している

**推奨される対応**:

1. `useMemo`や`useCallback`を使用して不要な再計算を防ぐ
2. Rechartsのアニメーション設定を最適化する

**優先度**: 低

**想定工数**: 2-3時間

---

## ユーザビリティ

### 10. ローディング状態の改善

**ファイル**: `src/app/page.tsx` (122-131行目)

**現状**:

- シンプルなスピナーのみ表示される

**問題点**:

- 何を読み込んでいるかがわかりにくい
- プログレス情報がない

**推奨される対応**:

1. 読み込み中の具体的な処理を表示する
2. スケルトンスクリーンを使用してレイアウトシフトを防ぐ

**優先度**: 低

**想定工数**: 2-3時間

---

### 12. レスポンシブデザインの改善

**ファイル**: `src/app/page.tsx`

**現状**:

- モバイルでの表示は考慮されているが、タブレットサイズの最適化が不足

**問題点**:

- 中間サイズの画面での表示が最適化されていない
- テーブルが横スクロールになる場合の案内が不足

**推奨される対応**:

1. タブレットサイズ用のレイアウトを追加する
2. 横スクロール可能な要素には視覚的なヒントを表示する

**優先度**: 低

**想定工数**: 2-3時間

---

### 14. 型定義のさらなる強化

**ファイル**: `src/types/dividend.ts`

**現状**:

- 基本的な型定義は存在し、よく整理されている

**問題点**:

- 為替レートの型がnumberのみで、範囲制約がない
- より厳密なバリデーションが可能

**推奨される対応**:

1. branded typeを使用して為替レートの型安全性を向上させる
2. Zodなどのスキーマバリデーションライブラリを導入する
3. ランタイムでのデータ検証を強化する

**優先度**: 低

**想定工数**: 3-4時間

---

## ドキュメント

### 17. Storybookの導入

**現状**:

- コンポーネントカタログやビジュアルテストツールが存在しない

**問題点**:

- コンポーネントの単体での動作確認が困難
- デザインシステムの管理が難しい

**推奨される対応**:

1. Storybookを導入してコンポーネントカタログを作成する
2. 各コンポーネントのストーリーを作成する
3. ビジュアルリグレッションテストを追加する

**優先度**: 低

**想定工数**: 6-8時間

---

## その他の改善提案

### 18. TypeScript設定の最適化

**ファイル**: `tsconfig.json`

**現状**:

- 基本的な設定は適切だが、より厳格にできる

**推奨される対応**:

1. 以下のオプションを有効化する:
    - `noUncheckedIndexedAccess`: 配列アクセスの安全性向上
    - `noPropertyAccessFromIndexSignature`: オブジェクトアクセスの安全性向上
    - `exactOptionalPropertyTypes`: オプショナルプロパティの厳密化

**優先度**: 低

**想定工数**: 1-2時間

---

### 19. CI/CDパイプラインの強化

**ファイル**: `.github/workflows/ci.yml`

**現状**:

- 基本的なCI設定は存在するが、拡張可能

**推奨される対応**:

1. ビルド成果物をキャッシュする
2. テストカバレッジレポートを自動生成・コメントする
3. PRにサイズ変化を自動コメントする
4. Lighthouse CIを追加してパフォーマンスを監視する

**優先度**: 中

**想定工数**: 4-6時間

---

### 20. アクセシビリティの向上

**現状**:

- 基本的なアクセシビリティは考慮されているが、さらに改善可能

**推奨される対応**:

1. 全てのインタラクティブ要素にaria-labelを追加する
2. キーボードナビゲーションを改善する
3. スクリーンリーダーでの使用を検証する
4. eslint-plugin-jsx-a11yを追加する

**優先度**: 中

**想定工数**: 3-4時間

---

### 21. 国際化（i18n）対応の準備

**現状**:

- 全て日本語で実装されている

**推奨される対応**:

1. next-intlまたはnext-i18nextを導入する
2. 文字列を外部ファイルに分離する
3. 英語版を追加する

**優先度**: 低

**想定工数**: 8-12時間

---

## 優先度別まとめ

### 高優先度（すぐに対応すべき）

現在、高優先度の項目は全て完了しています。

### 中優先度（近いうちに対応すべき）

- [1. CSVファイルパスのハードコーディング](#1-csvファイルパスのハードコーディング)
- [3. エラーハンドリングの改善](#3-エラーハンドリングの改善)
- [4. E2Eテストの不在](#4-e2eテストの不在)
- [5. Content Security Policyの未設定](#5-content-security-policy-csp-の未設定)
- [6. 依存関係の脆弱性チェックの強化](#6-依存関係の脆弱性チェックの強化)
- [9. 為替レート入力のバリデーション改善](#9-為替レート入力のバリデーション改善)
- [11. データがない場合の表示改善](#11-データがない場合の表示改善)
- [13. 設定ファイルの集約](#13-設定ファイルの集約)
- [19. CI/CDパイプラインの強化](#19-cicdパイプラインの強化)
- [20. アクセシビリティの向上](#20-アクセシビリティの向上)

### 低優先度（余裕があれば対応）

- [2. マジックナンバーの定数化](#2-マジックナンバーの定数化)
- [7. CSVデータのキャッシング](#7-csvデータのキャッシング)
- [8. チャートコンポーネントの最適化](#8-チャートコンポーネントの最適化)
- [10. ローディング状態の改善](#10-ローディング状態の改善)
- [12. レスポンシブデザインの改善](#12-レスポンシブデザインの改善)
- [14. 型定義のさらなる強化](#14-型定義のさらなる強化)
- [15. コントリビューションガイドの不足](#15-コントリビューションガイドの不足)
- [16. CHANGELOGの不足](#16-changelogの不足)
- [17. Storybookの導入](#17-storybookの導入)
- [18. TypeScript設定の最適化](#18-typescript設定の最適化)
- [21. 国際化（i18n）対応の準備](#21-国際化i18n対応の準備)

---

## 次のステップ

1. 各改善項目についてissueを作成する
2. 優先度に基づいて実装順序を決定する
3. 各issueに対応するPRを作成して段階的に改善を進める
4. 定期的にこのドキュメントを更新し、進捗を追跡する

---

## 備考

- このドキュメントは2026年2月7日時点での調査結果に基づいています
- 2026年2月7日の大規模リファクタリングにより、多くの重要な改善が完了しました
- 実装の際は、各項目の優先度と工数を考慮して計画を立ててください
- 新しい改善点が見つかった場合は、このドキュメントに追加してください

---

## 変更履歴

### 2026年2月7日
- 大規模リファクタリングによる完了項目を追加
  - コンポーネント分割
  - カスタムフックの追加
  - ビジネスロジックの分離
  - テストカバレッジの追加
  - JSDocコメントの追加
  - アーキテクチャドキュメントの追加
- 項目番号を振り直し、完了した項目を整理
- 優先度別まとめを更新

### 2026年2月5日
- 初版作成
- 25項目の改善提案をリストアップ
